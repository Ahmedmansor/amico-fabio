import"./global-footer-Sc3ZDEhu.js";import"./ui-layout-BzRTcNJb.js";import{i as q}from"./faq-loader-Dy4lez7k.js";const i={init:async()=>{const e=new URLSearchParams(window.location.search).get("id");sessionStorage.setItem("fabio_nav_source","details");const o=document.getElementById("whatsapp-float");o&&o.remove();const t=document.querySelector(".wa-fab-label");t&&t.remove();const a=document.getElementById("hero-back-btn");if(a&&(a.onclick=()=>{document&&document.referrer?window.history.back():window.location.href="explore.html"}),i.setupFaqAccordion(),!e){window.location.href="index.html";return}typeof i.renderGalleryImmediate=="function"&&i.renderGalleryImmediate(e);const r=localStorage.getItem("fabio_lang")||document.documentElement.lang||"it",d=r==="en"?window.i18nEn||{}:window.i18nIt||{},g=d.trips?d.trips[e]:null;let l=null;const m=sessionStorage.getItem("fabio_data_cache");if(m)try{const c=JSON.parse(m);l=(Array.isArray(c)?c:c.Trips_Prices||[]).find(w=>w.trip_id===e)}catch{}if(l||g){if(l)i.render(e,l,g,r);else if(i.renderStaticFirst(e,g,r),window.api&&window.api.fetchAllData){const c=await window.api.fetchAllData();sessionStorage.setItem("fabio_data_cache",JSON.stringify(c));const w=(c.Trips_Prices||[]).find(f=>f.trip_id===e);w&&i.updatePriceOnly(w)}}else{const c=r==="en"?window.i18nEn||{}:window.i18nIt||{},u=c&&c.global&&typeof c.global.experience_not_found=="string"?c.global.experience_not_found:"";document.querySelector("main").innerHTML=`
                <div class="h-screen flex items-center justify-center text-white">
                    <h1 class="text-3xl font-playfair text-gold" data-i18n="global.experience_not_found">${u}</h1>
                </div>
            `}},state:{apiData:null,langData:null,lang:"it",tripId:"",autoTimer:null,autoIndex:0,autoList:[]},iconMarkup:(n,e)=>{const o=window.ImagePaths&&window.ImagePaths.icons&&window.ImagePaths.icons.people?window.ImagePaths.icons.people:null,t=o&&o[n]?o[n]:"";return t?`<img src="${t}" alt="" class="price-icon-img">`:e},applyHeroImage:(n,e)=>{!n||!e||(n.classList.remove("hero-img-animate"),n.offsetWidth,n.src=e,n.classList.add("hero-img-animate"))},startAutoHero:(n,e,o=0)=>{!e||!Array.isArray(n)||n.length<2||(i.state.autoTimer&&(clearInterval(i.state.autoTimer),i.state.autoTimer=null),i.state.autoList=n.slice(),i.state.autoIndex=Math.max(0,Math.min(o,n.length-1)),i.state.autoTimer=setInterval(()=>{const t=i.state.autoList||[];if(!t.length)return;const a=(i.state.autoIndex+1)%t.length;i.state.autoIndex=a,i.applyHeroImage(e,t[a])},2e3))},setHeroImage:(n,e,o)=>{if(!n||!e)return;i.applyHeroImage(n,e);const t=i.state.autoList||[];if(t.length){const a=t.indexOf(e);i.startAutoHero(t,n,a>=0?a:0)}if(o){const a=o.querySelector(`img[src="${e}"]`),r=a?a.closest("div"):null;r&&typeof r.scrollIntoView=="function"&&r.scrollIntoView({behavior:"smooth",inline:"center",block:"nearest"})}},render:(n,e,o,t)=>{const a=localStorage.getItem("fabio_lang")||document.documentElement.lang||"it",r=a==="en"?window.i18nEn||{}:window.i18nIt||{},d=r.trips?r.trips[n]:null;t=a,o=d||o;const g=o&&o.title||e&&e.trip_id||n,l=e?parseFloat(e.p_adult||"0"):0,m=e?parseFloat(e.d_adult||"0"):0,c=e?parseFloat(e.p_child||"0"):0,u=e?parseFloat(e.d_child||"0"):0,w=e?parseInt(e.min_pax||"1",10):1,f=e?t==="en"?e.badge_en:e.badge_it:"";document.title=`Fabio Tours | ${g}`;const h=document.querySelector('meta[name="description"]')||(function(){const p=document.createElement("meta");return p.setAttribute("name","description"),document.head.appendChild(p),p})(),b=o&&o.short_desc||o&&o.full_description||"",v=typeof b=="string"?b.replace(/\s+/g," ").trim().slice(0,200):"";h&&h.setAttribute("content",v);const s={bg:document.getElementById("hero-bg-img"),title:document.getElementById("detail-title"),badge:document.getElementById("detail-badge"),duration:document.getElementById("detail-duration"),price:document.getElementById("detail-price"),desc:document.getElementById("detail-desc"),highlights:document.getElementById("detail-highlights"),fullDesc:document.getElementById("detail-full-desc"),program:document.getElementById("detail-program"),important:document.getElementById("detail-important"),cardPrice:document.getElementById("card-price"),includes:document.getElementById("detail-includes"),excludes:document.getElementById("detail-excludes"),gallery:document.getElementById("gallery-grid"),btnBook:document.getElementById("btn-submit-booking")||document.getElementById("btn-book")},x=(typeof window<"u"&&window.location&&window.location.pathname?window.location.pathname.split("/"):[]).filter(Boolean)[0]||"",L=x?`/${x}/`:"/",B=typeof window<"u"&&window.FABIO_BASE_URL||L,I=window.ImagePaths?window.ImagePaths.resolveTripContext({trip_id:n,...e||{}}):{location:"",category:""},M=window.ImagePaths?window.ImagePaths.getPoster(I.location,I.category,n):`${B}assets/images/trips/${n}/poster.webp`,R=window.ImagePaths?window.ImagePaths.ui.fallbackLogo:`${B}assets/images/logo/logo-fabio-square.webp`;s.bg&&(i.applyHeroImage(s.bg,M),window.ImagePaths&&typeof window.ImagePaths.resolvePosterOrPlaceholder=="function"?window.ImagePaths.resolvePosterOrPlaceholder(I.location,I.category,n).then(p=>{i.applyHeroImage(s.bg,p)}):s.bg.onerror=()=>{i.applyHeroImage(s.bg,R)}),s.title&&(s.title.textContent=g),f?s.badge&&(s.badge.textContent=f,s.badge.style.display="inline-block"):s.badge&&(s.badge.style.display="none");const $=i.iconMarkup("personMale","ðŸ‘¤"),G=i.iconMarkup("persons","ðŸ‘¥"),H=i.iconMarkup("child","ðŸ‘¶"),j=m>0?`<span class="inline-flex items-center gap-2">${$}<span class="line-through text-gray-400">â‚¬${l}</span><span class="text-gold font-bold">â‚¬${m}</span></span>`:`<span class="inline-flex items-center gap-2">${$}<span class="text-gold font-bold">â‚¬${l}</span></span>`;s.price&&(s.price.innerHTML=j);const T=m>0?m:l;s.cardPrice&&(s.cardPrice.textContent=`â‚¬${T}`);const C=document.getElementById("live-total-price");C&&(C.textContent=`â‚¬${T}`);const F=document.getElementById("card-price-breakdown");if(F){const _=(r&&r.global&&r.global.pricing?r.global.pricing:{}).min_pax||"Min Pax",P=m>0?`<div class="flex items-center gap-2">${$}<span class="line-through text-gray-400">â‚¬${l}</span><span class="text-white font-bold">â‚¬${m}</span></div>`:`<div class="flex items-center gap-2">${$}<span class="text-white font-bold">â‚¬${l}</span></div>`,E=u>0||c>0?u>0?`<div class="flex items-center gap-2">${H}<span class="line-through text-gray-400">â‚¬${c}</span><span class="text-white font-bold">â‚¬${u}</span></div>`:`<div class="flex items-center gap-2">${H}<span class="text-white font-bold">â‚¬${c}</span></div>`:"",S=`<div class="flex items-center gap-2">${G}<span class="text-gray-300">${_}: ${w}</span></div>`;F.innerHTML=`${P}${E||""}${S}`}if(o){const p=t==="en"?window.i18nEn||{}:window.i18nIt||{},_=p&&p.global&&typeof p.global.daily=="string"?p.global.daily:"";s.duration&&(s.duration.textContent=o.duration||_),s.desc&&(s.desc.innerHTML=o.short_desc||""),s.fullDesc&&(s.fullDesc.innerHTML=o.full_description||""),s.important&&(s.important.textContent=o.important_notes||""),i.renderList(s.highlights,o.highlights),i.renderList(s.includes,o.includes,!0,"check"),i.renderList(s.excludes,o.not_included,!0,"cross"),s.program&&o.program&&i.renderProgram(s.program,o.program)}const A=t==="en"?window.i18nEn||{}:window.i18nIt||{},N=A&&A.global&&typeof A.global.book_now=="string"?A.global.book_now:"";s.btnBook&&(s.btnBook.textContent=N);const O=document.getElementById("sticky-mobile-book");O&&(setTimeout(()=>{O.classList.remove("translate-y-32")},200),i.setupStickyBehavior());const z=window.ImagePaths&&typeof window.ImagePaths.pickCI=="function"?window.ImagePaths.pickCI(e||{},"img_count"):"",U=parseInt(z||"0",10),k=window.ImagePaths&&typeof window.ImagePaths.getGalleryArray=="function"?window.ImagePaths.getGalleryArray(I.location,I.category,n,U):[],J=[M,...Array.isArray(k)?k:[]];s.gallery&&s.gallery.children.length===0&&(i.appendGalleryItem(M,s.gallery,s.bg),Array.isArray(k)&&k.length>0&&k.forEach(p=>i.appendGalleryItem(p,s.gallery,s.bg))),s.bg&&i.startAutoHero(J,s.bg,0);try{const p=sessionStorage.getItem("fabio_data_cache")||sessionStorage.getItem("fabio_trips_cache");let _=[];if(p){const P=JSON.parse(p),E=P&&Array.isArray(P.Trip_Addons)?P.Trip_Addons:[];_=Array.isArray(E)?E.filter(S=>String(S.trip_id||"")===n):[]}i.state.apiData=e,i.state.langData=o,i.state.lang=t,i.state.tripId=n,window.BookingManager&&window.BookingManager.init(n,e,o,_)}catch{i.state.apiData=e,i.state.langData=o,i.state.lang=t,i.state.tripId=n,window.BookingManager&&window.BookingManager.init(n,e,o,[])}},setupStickyBehavior:()=>{const n=document.getElementById("sticky-mobile-book"),e=document.getElementById("booking-card-container");if(!n||!e)return;const o=n.querySelector('span[data-i18n="global.book_now"]');setInterval(()=>{o&&(o.classList.add("animate-wiggle"),setTimeout(()=>o.classList.remove("animate-wiggle"),1200))},8e3),new IntersectionObserver(r=>{const d=r[0];d&&d.isIntersecting&&d.intersectionRatio>.2?(n.classList.add("opacity-0","pointer-events-none"),n.classList.remove("opacity-100")):(n.classList.add("opacity-100"),n.classList.remove("opacity-0","pointer-events-none"))},{root:null,threshold:[0,.2,.5,1]}).observe(e)},renderStaticFirst:(n,e,o)=>{const t={bg:document.getElementById("hero-bg-img"),title:document.getElementById("detail-title"),badge:document.getElementById("detail-badge"),duration:document.getElementById("detail-duration"),price:document.getElementById("detail-price"),desc:document.getElementById("detail-desc"),highlights:document.getElementById("detail-highlights"),fullDesc:document.getElementById("detail-full-desc"),program:document.getElementById("detail-program"),important:document.getElementById("detail-important"),cardPrice:document.getElementById("card-price"),cardBreakdown:document.getElementById("card-price-breakdown"),includes:document.getElementById("detail-includes"),excludes:document.getElementById("detail-excludes"),gallery:document.getElementById("gallery-grid"),btnBook:document.getElementById("btn-submit-booking")||document.getElementById("btn-book")},r=(typeof window<"u"&&window.location&&window.location.pathname?window.location.pathname.split("/"):[]).filter(Boolean)[0]||"",d=r?`/${r}/`:"/",g=typeof window<"u"&&window.FABIO_BASE_URL||d,l=window.ImagePaths?window.ImagePaths.resolveTripContext({trip_id:n}):{location:"",category:""},m=window.ImagePaths?window.ImagePaths.getPoster(l.location,l.category,n):`${g}assets/images/trips/${n}/poster.webp`,c=window.ImagePaths?window.ImagePaths.ui.fallbackLogo:`${g}assets/images/logo/logo-fabio-square.webp`;t.bg&&(i.applyHeroImage(t.bg,m),window.ImagePaths&&typeof window.ImagePaths.resolvePosterOrPlaceholder=="function"?window.ImagePaths.resolvePosterOrPlaceholder(l.location,l.category,n).then(y=>{i.applyHeroImage(t.bg,y)}):t.bg.onerror=()=>{i.applyHeroImage(t.bg,c)});const u=e&&e.title||n;t.title&&(t.title.textContent=u),t.price&&(t.price.innerHTML='<span class="price-skeleton inline-block"></span>'),t.cardPrice&&(t.cardPrice.innerHTML='<span class="price-skeleton inline-block"></span>'),t.cardBreakdown&&(t.cardBreakdown.innerHTML='<div class="price-skeleton" style="width: 80%; height: 1.2rem;"></div>');const w=document.getElementById("live-total-price");if(w&&(w.textContent="â‚¬0"),e){const y=o==="en"?window.i18nEn||{}:window.i18nIt||{},x=y&&y.global&&typeof y.global.daily=="string"?y.global.daily:"";t.duration&&(t.duration.textContent=e.duration||x),t.desc&&(t.desc.innerHTML=e.short_desc||""),t.fullDesc&&(t.fullDesc.innerHTML=e.full_description||""),t.important&&(t.important.textContent=e.important_notes||""),i.renderList(t.highlights,e.highlights),i.renderList(t.includes,e.includes,!0,"check"),i.renderList(t.excludes,e.not_included,!0,"cross"),t.program&&e.program&&i.renderProgram(t.program,e.program)}const f=window.ImagePaths&&typeof window.ImagePaths.getGalleryArray=="function"?window.ImagePaths.getGalleryArray(l.location,l.category,n,0):[],h=[m,...Array.isArray(f)?f:[]];t.gallery&&t.gallery.children.length===0&&(i.appendGalleryItem(m,t.gallery,t.bg),Array.isArray(f)&&f.length>0&&f.forEach(y=>i.appendGalleryItem(y,t.gallery,t.bg))),t.bg&&i.startAutoHero(h,t.bg,0);const b=o==="en"?window.i18nEn||{}:window.i18nIt||{},v=b&&b.global&&typeof b.global.book_now=="string"?b.global.book_now:"";t.btnBook&&(t.btnBook.textContent=v);const s=document.getElementById("sticky-mobile-book");s&&setTimeout(()=>{s.classList.remove("translate-y-32")},200)},updatePriceOnly:n=>{const e=document.getElementById("detail-price"),o=document.getElementById("card-price"),t=document.getElementById("card-price-breakdown"),a=parseFloat(n.p_adult||"0"),r=parseFloat(n.d_adult||"0"),d=parseFloat(n.p_child||"0"),g=parseFloat(n.d_child||"0"),l=parseInt(n.min_pax||"1",10),m=i.iconMarkup("personMale","ðŸ‘¤"),c=r>0?`<span class="inline-flex items-center gap-2">${m}<span class="line-through text-gray-400">â‚¬${a}</span><span class="text-gold font-bold">â‚¬${r}</span></span>`:`<span class="inline-flex items-center gap-2">${m}<span class="text-gold font-bold">â‚¬${a}</span></span>`;e&&(e.innerHTML=c);const u=r>0?r:a;o&&(o.textContent=`â‚¬${u}`);const w=document.getElementById("live-total-price");if(w&&(w.textContent=`â‚¬${u}`),i.state.apiData=n,window.BookingManager&&(BookingManager.state.apiData=n,BookingManager.calculateTotal()),t){const h=(localStorage.getItem("fabio_lang")||document.documentElement.lang||"it")==="en"?window.i18nEn||{}:window.i18nIt||{},v=(h&&h.global&&h.global.pricing?h.global.pricing:{}).min_pax||"Min Pax",s=i.iconMarkup("personMale","ðŸ‘¤"),y=i.iconMarkup("persons","ðŸ‘¥"),x=i.iconMarkup("child","ðŸ‘¶"),L=r>0?`<div class="flex items-center gap-2">${s}<span class="line-through text-gray-400">â‚¬${a}</span><span class="text-white font-bold">â‚¬${r}</span></div>`:`<div class="flex items-center gap-2">${s}<span class="text-white font-bold">â‚¬${a}</span></div>`,B=g>0||d>0?g>0?`<div class="flex items-center gap-2">${x}<span class="line-through text-gray-400">â‚¬${d}</span><span class="text-white font-bold">â‚¬${g}</span></div>`:`<div class="flex items-center gap-2">${x}<span class="text-white font-bold">â‚¬${d}</span></div>`:"",I=`<div class="flex items-center gap-2">${y}<span class="text-gray-300">${v}: ${l}</span></div>`;t.innerHTML=`${L}${B||""}${I}`}},renderGalleryImmediate:n=>{const e={gallery:document.getElementById("gallery-grid"),bg:document.getElementById("hero-bg-img")};if(!e.gallery)return;const o=window.ImagePaths?window.ImagePaths.resolveTripContext({trip_id:n}):{location:"",category:""},a=(typeof window<"u"&&window.location&&window.location.pathname?window.location.pathname.split("/"):[]).filter(Boolean)[0]||"",r=a?`/${a}/`:"/",d=typeof window<"u"&&window.FABIO_BASE_URL||r,g=window.ImagePaths?window.ImagePaths.getPoster(o.location,o.category,n):`${d}assets/images/trips/${n}/poster.webp`;e.gallery.innerHTML="",i.appendGalleryItem(g,e.gallery,e.bg);const l=window.ImagePaths&&typeof window.ImagePaths.getGalleryArray=="function"?window.ImagePaths.getGalleryArray(o.location,o.category,n,0):[];Array.isArray(l)&&l.length>0&&l.forEach(c=>i.appendGalleryItem(c,e.gallery,e.bg));const m=[g,...Array.isArray(l)?l:[]];e.bg&&i.startAutoHero(m,e.bg,0)},appendGalleryItem:(n,e,o)=>{if(Array.from(e.querySelectorAll("img")).some(r=>r.getAttribute("src")===n))return;const a=document.createElement("div");a.className="flex-shrink-0 w-32 h-32 md:w-40 md:h-40 aspect-square rounded-xl overflow-hidden cursor-pointer relative group border border-gray-100 shadow-md snap-center",a.innerHTML=`
            <img src="${n}" class="w-full h-full object-cover transform transition-transform duration-700 group-hover:scale-110">
            <div class="absolute inset-0 bg-black/20 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center">
                <svg class="w-8 h-8 text-white drop-shadow-lg" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
            </div>
        `,a.onclick=()=>{i.setHeroImage(o,n,e)},e.appendChild(a)},renderList:(n,e,o=!1,t="check")=>{!e||!Array.isArray(e)||!n||(n.innerHTML=e.map(a=>`
            <li class="flex items-start leading-relaxed border-b border-gray-100 pb-2 last:border-0">
                ${o?t==="check"?'<span class="text-gold mr-3 font-bold">âœ“</span>':'<span class="text-gray-400 mr-3 font-bold">Ã—</span>':'<span class="text-gold mr-3 text-xl">â€¢</span>'}
                <span class="${o?n.id==="detail-highlights"?"text-white text-sm":"text-gray-600 text-sm":n.id==="detail-highlights"?"text-white font-medium":"text-gray-800 font-medium"}">${a}</span>
            </li>
            `).join(""))},renderProgram:(n,e)=>{if(!e||!Array.isArray(e)||!n)return;const o=e.map((t,a)=>{const r=t&&typeof t=="object",d=r&&t.time||"",g=r&&t.activity||"",l=r?t.details||"":String(t||"");return`
                <div class="flex gap-4 mb-6 last:mb-0 relative">
                    <div class="flex flex-col items-center">
                        <div class="w-8 h-8 rounded-full bg-gold text-white flex items-center justify-center font-bold text-sm shadow-lg z-10">
                            ${a+1}
                        </div>
                        ${a!==e.length-1?'<div class="w-0.5 h-full bg-gray-100 absolute top-8"></div>':""}
                    </div>
                    <div class="pb-2">
                        ${d?`<div class="text-sm text-gray-500 mb-1">${d}</div>`:""}
                        ${g?`<div class="text-white font-semibold mb-1">${g}</div>`:""}
                        <p class="text-gray-300 leading-relaxed">${l}</p>
                    </div>
                </div>
            `}).join("");n.innerHTML=o},setupFaqAccordion:()=>{const n=document.querySelectorAll(".faq-item");n.length&&n.forEach(e=>{const o=e.querySelector(".faq-toggle"),t=e.querySelector(".faq-answer"),a=e.querySelector(".faq-icon");!o||!t||o.dataset.bound!=="true"&&(o.dataset.bound="true",o.setAttribute("aria-expanded","false"),t.style.maxHeight="0px",e.classList.remove("is-open"),o.addEventListener("click",()=>{if(o.getAttribute("aria-expanded")==="true"){o.setAttribute("aria-expanded","false"),t.style.maxHeight="0px",e.classList.remove("is-open"),a&&a.classList.remove("rotate-45");return}o.setAttribute("aria-expanded","true"),e.classList.add("is-open"),t.style.maxHeight=`${t.scrollHeight}px`,a&&a.classList.add("rotate-45")}))})}};window.DetailsRenderer=i;window.addEventListener("langChanged",()=>{window.DetailsRenderer&&typeof window.DetailsRenderer.init=="function"&&window.DetailsRenderer.init()});console.log("Trying to init FAQ...");document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{console.log("DOM ready, initializing FAQ..."),q()}):(console.log("DOM already loaded, initializing FAQ immediately..."),q());
