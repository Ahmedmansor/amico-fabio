async function u(t,a={}){const{timeout:e=5e3}=a,n=new AbortController,o=setTimeout(()=>n.abort(),e),l=await fetch(t,{...a,signal:n.signal});return clearTimeout(o),l}const h={Trips_Prices:"https://docs.google.com/spreadsheets/d/e/2PACX-1vQvcO6TH0o6KOqLY6vy-jp-ZcBEeLq_dGmAzmcOCWUeIOSfOAJLPJAFa1D80a4Bv-XVLbdYOJxclEwj/pub?gid=0&single=true&output=csv",Global_Settings:"https://docs.google.com/spreadsheets/d/e/2PACX-1vQvcO6TH0o6KOqLY6vy-jp-ZcBEeLq_dGmAzmcOCWUeIOSfOAJLPJAFa1D80a4Bv-XVLbdYOJxclEwj/pub?gid=1501122855&single=true&output=csv",Trip_Addons:"https://docs.google.com/spreadsheets/d/e/2PACX-1vQvcO6TH0o6KOqLY6vy-jp-ZcBEeLq_dGmAzmcOCWUeIOSfOAJLPJAFa1D80a4Bv-XVLbdYOJxclEwj/pub?gid=468088862&single=true&output=csv",Packages:"https://docs.google.com/spreadsheets/d/e/2PACX-1vQvcO6TH0o6KOqLY6vy-jp-ZcBEeLq_dGmAzmcOCWUeIOSfOAJLPJAFa1D80a4Bv-XVLbdYOJxclEwj/pub?gid=457429210&single=true&output=csv"};function w(t){if(!t||typeof t!="string")return[];const a=[];let e=[],n="",o=!1;for(let i=0;i<t.length;i++){const s=t[i],c=t[i+1];s==='"'?o&&c==='"'?(n+='"',i+=1):o=!o:s===","&&!o?(e.push(n),n=""):(s===`
`||s==="\r")&&!o?(s==="\r"&&c===`
`&&(i+=1),e.push(n),n="",e.length>0&&e.some(r=>String(r).trim().length>0)&&a.push(e),e=[]):n+=s}if(e.push(n),e.length>0&&e.some(i=>String(i).trim().length>0)&&a.push(e),a.length===0)return[];const l=a[0].map(i=>String(i).trim()),_=a.slice(1),m=[];for(let i=0;i<_.length;i++){const s=_[i],c={};for(let r=0;r<l.length;r++){const g=l[r],d=s[r]!==void 0?String(s[r]).replace(/\r?\n/g," ").trim():"";c[g]=d}m.push(c)}return m}function b(t){const a={yacht_white:"ras_mohammed_white_island_vip",ras_mohammed_boat:"ras_mohammed_white_island_vip",ras_mohammed_white_island_vip:"ras_mohammed_white_island_vip",safari_quad:"desert_quad_bike_safari",quad_safari:"desert_quad_bike_safari",cairo_pyramids:"cairo_pyramids_classic",cairo_by_plane:"cairo_pyramids_by_plane",ras_mohammed_bus:"ras_mohammed_bus_half_day",tiran_boat:"tiran_island_boat_vip",tiran_island_boat_vip:"tiran_island_boat_vip",luxor_tour:"luxor_day_trip",aswan_tour:"aswan_day_trip"},e=String(t||"").trim();return a.hasOwnProperty(e)?a[e]:e}function x(t){return Array.isArray(t)?t.map(a=>{const e={...a};return e.trip_id=b(e.trip_id),e}):[]}async function A(){try{const t=sessionStorage.getItem("fabio_trips_cache");if(t){const d=JSON.parse(t);if(d&&d.Trips_Prices&&d.Global_Settings&&d.Trip_Addons)return d.Packages||(d.Packages=[]),d}console.log("Fetching data with 5s timeout...");const[a,e,n,o]=await Promise.all([u(h.Trips_Prices),u(h.Global_Settings),u(h.Trip_Addons),u(h.Packages)]);if(!a.ok||!e.ok||!n.ok||!o.ok)throw new Error("Failed to fetch one or more data sources.");const l=await a.text(),_=await e.text(),m=await n.text(),i=await o.text(),s=x(w(l)),c=w(i),r=Array.isArray(c)?c.map(d=>{const p={...d},f=String(p.package_id||"").trim();f&&(p.package_id=f,p.trip_id=b(f));const y=String(p.included_trip_ids||"").trim();return y?p.included_trip_ids=y.split(",").map(k=>b(k.trim())).filter(Boolean):p.included_trip_ids=[],p.type="package",p}):[],g={Trips_Prices:s,Global_Settings:w(_),Trip_Addons:w(m),Packages:r};try{sessionStorage.setItem("fabio_trips_cache",JSON.stringify(g))}catch{}return g}catch(t){console.warn("Data Fetch Failed or Timed Out. Using Dummy Data.",t);const a=sessionStorage.getItem("fabio_trips_cache");if(a){const e=JSON.parse(a);if(e&&e.Trips_Prices&&e.Global_Settings&&e.Trip_Addons)return e.Packages||(e.Packages=[]),e}return{Trips_Prices:[],Global_Settings:[],Trip_Addons:[],Packages:[]}}}window.api={fetchAllData:A};(function(){var t={ras_mohammed_white_island_vip:6,ras_mohammed_bus_half_day:4,tiran_island_boat_vip:5,dahab_blue_hole_super_safari:3,private_boat_vip_king:3,dolphin_show_family:3,swim_with_dolphins_vip:3,sina_dream_vip_day:3,dinner_cruise_night_show:3,water_sports_adrenaline_combo:3,albatros_aqua_park_full_day:2,seascope_semi_submarine:2,super_safari_5_senses:2,vip_romantic_dinner_desert:2,vip_cena_romantica:2,cairo_plane_flexible_museum:2,cairo_bus_adventure_choice:2,santa_caterina_monastery_morning:2,mount_sinai_sunrise_adventure:2,luxor_plane_classic:2,petra_jordan_expedition:2};window.TripsMetadata=t})();const v={init:()=>{v.renderHeroPortal(),v.renderWhatsApp()},renderHeroPortal:()=>{const t=document.getElementById("hero-portal");if(!t)return;const e=(localStorage.getItem("fabio_lang")||document.documentElement.lang||localStorage.getItem("lang")||"it")==="en"?window.i18nEn||{}:window.i18nIt||{},o=(typeof window<"u"&&window.location&&window.location.pathname?window.location.pathname.split("/"):[]).filter(Boolean)[0]||"",l=o?`/${o}/`:"/",_=typeof window<"u"&&window.FABIO_BASE_URL||l,m=window.ImagePaths&&window.ImagePaths.landing&&window.ImagePaths.landing.hero?window.ImagePaths.landing.hero:[`${_}assets/images/comandamenti-images/1.webp`,`${_}assets/images/comandamenti-images/2.webp`,`${_}assets/images/comandamenti-images/3.webp`];t.innerHTML=`
            <div class="relative w-full h-[500px] md:aspect-[21/9] rounded-[3rem] overflow-hidden shadow-2xl border border-white/10 group mx-auto">
                <!-- Background Stack (Flutter-like) -->
                <div id="hero-slider" class="absolute inset-0 bg-black">
                    ${m.map((c,r)=>`
                        <img src="${c}" 
                             class="hero-portal-img absolute inset-0 w-full h-full object-cover ${r===0?"active":""}" 
                             data-index="${r}">
                    `).join("")}
                </div>

                <!-- Overlay Gradient -->
                <div class="absolute inset-0 bg-gradient-to-t from-black/90 via-black/40 to-black/10 z-20"></div>

                <!-- Foreground Content -->
                <div class="absolute inset-0 flex flex-col items-center justify-end pb-16 z-30 text-center px-4">
                    <h2 class="text-4xl md:text-5xl font-playfair font-bold text-gold mb-4 leading-tight drop-shadow-xl tracking-wide" data-i18n="global.secrets_title">
                        ${e.global.secrets_title||"Non partire senza conoscere i 10 comandamenti di Fabio"}
                    </h2>
                    
                    <p class="text-cream text-lg md:text-xl font-light tracking-widest uppercase mb-8 opacity-90" data-i18n="global.ultimate_guide">
                        ${e.global.ultimate_guide||""}
                    </p>
                    
                    <a href="sharm-secrets.html" class="px-10 py-4 bg-gold text-black font-bold uppercase tracking-widest rounded-full hover:bg-white transition-all duration-300 shadow-[0_0_30px_rgba(197,160,89,0.4)] hover:scale-105 transform" data-i18n="global.read_secrets">
                        ${e.global.read_secrets||""}
                    </a>
                </div>
            </div>
        `;let i=0;const s=t.querySelectorAll(".hero-portal-img");s.length>1&&setInterval(()=>{s[i].classList.remove("active"),i=(i+1)%s.length,s[i].classList.add("active")},3e3)},renderPromoBanner:()=>{const t=document.getElementById("promo-banner");t&&t.remove()},renderWhatsApp:()=>{if(document.getElementById("whatsapp-float")||document.querySelector(".floating-whatsapp")||/\/details\.html$/i.test(window.location.pathname))return;const a=document.createElement("div");a.id="whatsapp-float",a.className="fab-base floating-whatsapp",a.onclick=()=>window.open("https://wa.me/201063239261","_blank"),a.innerHTML=`
            <span class="floating-whatsapp-icon" aria-hidden="true">
                <svg viewBox="0 0 32 32" class="floating-whatsapp-svg">
                    <path d="M16 3C9.4 3 4.1 8.1 4.1 14.6c0 2.5.8 4.8 2.3 6.8L5 27.5l6.3-1.9c1.8 1 3.8 1.5 5.8 1.5 6.6 0 11.9-5.1 11.9-11.6C29 8.1 22.6 3 16 3zm0 2.3c5.3 0 9.6 4.1 9.6 9.3 0 5.1-4.3 9.3-9.6 9.3-1.8 0-3.5-.5-5-1.3l-.4-.2-3.7 1.1 1.1-3.5-.2-.4c-1.2-1.5-1.8-3.3-1.8-5.1C6 9.4 10.3 5.3 16 5.3zm-3.4 4c-.3 0-.7.1-1 .1-.3.1-.8.4-.9.9-.2.5-.5 1.5-.5 1.7 0 .2-.1.6.3 1.1.4.5 1.1 1.7 2.4 2.8 1.3 1.2 2.9 1.9 3.4 2.1.5.2 1 .2 1.3.1.4-.1 1.3-.6 1.5-1.1.2-.5.2-1 .2-1.1s-.1-.3-.3-.4c-.2-.1-1.3-.6-1.5-.7-.2-.1-.4-.1-.6.1-.2.3-.7.8-.9 1-.2.1-.4.1-.6 0-.2-.1-.9-.3-1.7-1-.6-.6-1-1.3-1.2-1.5-.1-.3 0-.5.1-.6.1-.1.2-.2.3-.4.1-.1.1-.3 0-.4-.1-.1-.9-2.3-1.1-2.6-.1-.3-.3-.3-.4-.3z"></path>
                </svg>
            </span>
        `,document.body.appendChild(a)},setupInteractions:()=>{}};window.UILayout=v;window.addEventListener("langChanged",()=>{window.UILayout&&(typeof window.UILayout.renderPromoBanner=="function"&&window.UILayout.renderPromoBanner(),typeof window.UILayout.renderHeroPortal=="function"&&window.UILayout.renderHeroPortal())});
