import"./global-footer-Sc3ZDEhu.js";import"./ui-layout-BzRTcNJb.js";import"./trips-renderer-XuulvWXh.js";const e={state:{loc:null,sort:"default",category:"all",allRawTrips:[],filteredTrips:[],currentPage:1,itemsPerPage:9,hasLoadedOnce:!1},init:async()=>{const a=new URLSearchParams(window.location.search).get("loc")||"all",r=sessionStorage.getItem("fabio_nav_source");if(r==="details"){const o=sessionStorage.getItem("fabio_explore_sort"),l=sessionStorage.getItem("fabio_explore_cat");e.state.sort=o||"default",e.state.category=l||"all";const i=sessionStorage.getItem("fabio_explore_page");i&&(e.state.currentPage=parseInt(i))}else e.state.sort="default",e.state.category="all",e.state.currentPage=1,sessionStorage.setItem("fabio_explore_sort","default"),sessionStorage.setItem("fabio_explore_cat","all"),sessionStorage.removeItem("fabio_data_cache");e.state.loc=a,sessionStorage.setItem("fabio_last_loc",a);const n=sessionStorage.getItem("fabio_data_cache");let s=!1;if(r==="details"&&n)try{const o=JSON.parse(n);o&&(e.processData(o),s=!0)}catch(o){console.error("Cache parse error",o)}if(!s)if(e.renderFilterSkeleton&&e.renderFilterSkeleton(),e.renderCardSkeleton&&e.renderCardSkeleton(6),window.api&&window.api.fetchAllData){const o=await window.api.fetchAllData();sessionStorage.setItem("fabio_data_cache",JSON.stringify(o)),e.processData(o)}else e.renderOrEmpty&&e.renderOrEmpty();sessionStorage.removeItem("fabio_nav_source")},processData:t=>{const a=t.Trips_Prices||[],r=t.Packages||[],n=[...a,...r],s=String(e.state.loc||"all").toLowerCase().trim();e.state.allRawTrips=e._filterTrips(n,s),e.renderDynamicFilters&&e.renderDynamicFilters(),e.applyFiltersAndRender&&e.applyFiltersAndRender()},_filterTrips:(t,a)=>t.filter(r=>{const n=(c,d)=>{const g=Object.keys(c||{}).find(p=>p.toLowerCase().trim()===d);return g?c[g]:""},s=n(r,"location")||n(r,"loc")||n(r,"city")||"",o=String(s).toLowerCase().trim(),l=a==="all"||(a==="luxor_and_aswan"?o.includes("luxor")||o.includes("aswan"):o.includes(a)),i=String(r.is_active).toLowerCase()==="true"||r.is_active==="1"||r.is_active===!0;return l&&i}),resolveCategory:t=>{const a=t&&t.category||"",r=String(a).toLowerCase().trim();if(r)return r==="packages"?"bundles":r;if(window.ImagePaths&&typeof window.ImagePaths.resolveTripContext=="function"){const n=window.ImagePaths.resolveTripContext(t||{}),s=String(n&&n.category||"").toLowerCase().trim();if(s)return s}return"others"},renderDynamicFilters:()=>{const t=document.getElementById("filter-chips");if(!t)return;const a=new Set(e.state.allRawTrips.map(i=>e.resolveCategory(i))),r=["all",...Array.from(a).sort()],s=(localStorage.getItem("fabio_lang")||"it")==="en"?window.i18nEn||{}:window.i18nIt||{},o=s.global&&s.global.filters?s.global.filters:{};t.innerHTML=r.map(i=>{const c=e.state.category===i;let d;i==="bundles"?d=o.packages||"Packages":d=o[i]||i.charAt(0).toUpperCase()+i.slice(1);const g="inline-flex items-center justify-center h-8 px-3 rounded-full text-xs min-w-[64px] transition-colors";let p;return i==="bundles"?p=c?"bg-gold text-white font-bold border border-gold shadow-[0_0_24px_rgba(212,175,55,0.8)]":"bg-black/90 text-gold border border-gray-700 hover:border-gold shadow-none":p=c?"bg-transparent text-white border border-gold":"bg-black/60 text-white border border-gray-700 hover:border-gray-500",`<button class="${g} ${p}" onclick="ExploreRenderer.handleFilterClick('${i}')">${d}</button>`}).join("");const l=document.getElementById("price-sort");l&&(l.value=e.state.sort,l.onchange=i=>{e.state.sort=i.target.value;try{sessionStorage.setItem("fabio_explore_sort",e.state.sort)}catch{}e.applyFiltersAndRender()})},handleFilterClick:t=>{e.state.category=t,e.state.currentPage=1;try{sessionStorage.setItem("fabio_explore_cat",t)}catch{}e.renderDynamicFilters(),e.applyFiltersAndRender()},applyFiltersAndRender:()=>{let t=[...e.state.allRawTrips];e.state.category!=="all"&&(t=t.filter(r=>e.resolveCategory(r)===e.state.category)),t=e.sortTrips(t),e.state.filteredTrips=t;const a=Math.ceil(e.state.filteredTrips.length/e.state.itemsPerPage);a>0&&e.state.currentPage>a&&(e.state.currentPage=a),e.state.currentPage<1&&(e.state.currentPage=1),e.renderPage()},sortTrips:t=>{const a=e.state.sort,r=s=>{const o=parseFloat(s.d_adult||"0"),l=parseFloat(s.p_adult||"0");return o>0?o:l},n=s=>{const o=String(s.badge_it||"").trim()?2:0,l=String(s.badge_en||"").trim()?1:0;return o+l};return t.sort((s,o)=>{if(a==="price_asc")return r(s)-r(o);if(a==="price_desc")return r(o)-r(s);const l=n(o)-n(s);return l!==0?l:r(s)-r(o)})},renderPage:()=>{const t=document.getElementById("explore-grid");if(t){if(e.state.filteredTrips.length===0){e._renderNoResults(t),e._updatePagination(!0);return}e._renderGridItems(t),e._updatePagination(!1),e._postRenderEffects()}},_renderNoResults:t=>{const n=((localStorage.getItem("fabio_lang")||"it")==="en"?window.i18nEn||{}:window.i18nIt||{}).global?.no_exclusive_experiences||"No experiences found.";t.innerHTML=`<div class="col-span-full text-center py-20"><p class="text-gray-400 text-xl font-playfair italic">${n}</p></div>`},_renderGridItems:t=>{const a=(e.state.currentPage-1)*e.state.itemsPerPage,r=a+e.state.itemsPerPage,n=e.state.filteredTrips.slice(a,r),s=localStorage.getItem("fabio_lang")||"it";t.innerHTML="",n.forEach((o,l)=>{const i=window.TripsRenderer?window.TripsRenderer.createTripCard(o,s,l):null;i&&t.appendChild(i)}),e._updateCardsWithPrices(n)},_updatePagination:t=>{const a=document.getElementById("pagination-controls");if(!a)return;if(t){a.classList.add("hidden");return}const r=Math.ceil(e.state.filteredTrips.length/e.state.itemsPerPage);r>1?(a.classList.remove("hidden"),a.innerHTML=` 
        <button class="w-10 h-10 rounded-full border border-gold text-gold flex items-center justify-center disabled:opacity-30 disabled:cursor-not-allowed hover:bg-gold hover:text-black transition-colors" ${e.state.currentPage===1?"disabled":""} onclick="ExploreRenderer.changePage(${e.state.currentPage-1})">←</button> 
        <span class="text-white font-playfair text-lg">Page <span class="text-gold">${e.state.currentPage}</span> of ${r}</span> 
        <button class="w-10 h-10 rounded-full border border-gold text-gold flex items-center justify-center disabled:opacity-30 disabled:cursor-not-allowed hover:bg-gold hover:text-black transition-colors" ${e.state.currentPage===r?"disabled":""} onclick="ExploreRenderer.changePage(${e.state.currentPage+1})">→</button> 
      `):a.classList.add("hidden")},_postRenderEffects:()=>{if(e.state.hasLoadedOnce){const t=document.querySelector("section");t&&t.scrollIntoView({behavior:"smooth"})}e.state.hasLoadedOnce=!0},changePage:t=>{e.state.currentPage=t;try{sessionStorage.setItem("fabio_explore_page",t)}catch{}e.renderPage()},renderFilterSkeleton:()=>{const t=document.getElementById("filter-chips");t&&(t.innerHTML=Array(4).fill(0).map(()=>'<div class="chip-skeleton"></div>').join(""))},renderCardSkeleton:t=>{const a=document.getElementById("explore-grid");a&&(a.innerHTML=Array(t).fill(0).map(()=>` 
      <div class="bg-[#1a1510] rounded-2xl shadow-xl overflow-hidden h-full flex flex-col border border-white/5 relative min-h-[400px]"> 
        <div class="h-[220px] w-full bg-gray-800/50 relative overflow-hidden animate-pulse"></div> 
        <div class="p-6 flex-grow space-y-6"> 
          <div class="h-7 bg-gray-800/50 rounded-lg w-3/4 animate-pulse"></div> 
        </div> 
      </div>`).join(""))},_updateCardsWithPrices:t=>{const a=localStorage.getItem("fabio_lang")||document.documentElement.lang||"it";t.forEach(r=>{const n=document.querySelector(`article.catalog-card[data-trip-id="${r.trip_id}"]`);if(!n)return;const s=n.querySelector(".price-block");if(s){const i=parseFloat(r.d_adult||"0"),c=parseFloat(r.p_adult||"0");let d="";i>0?d=`<div class="price-row fade-in-soft"><span class="price-old">€${c}</span><span class="price-new">€${i}</span></div>`:c>0&&(d=`<div class="price-row fade-in-soft"><span class="price-new">€${c}</span></div>`);const g=s.querySelector(".price-skeleton"),p=s.querySelector(".price-row");d&&(g||!p)&&(g&&g.remove(),p||s.insertAdjacentHTML("beforeend",d));const f=s.querySelectorAll(".price-row");f.length>1&&f.forEach((u,m)=>{m>0&&u.remove()})}const o=n.querySelector(".card-badges"),l=a==="en"?r.badge_en||"":r.badge_it||"";o&&l&&!o.querySelector(".standard-badge")&&o.insertAdjacentHTML("beforeend",`<span class="standard-badge fade-in-soft">${l}</span>`)})},renderOrEmpty:()=>{const t=document.getElementById("explore-grid");t&&(t.innerHTML="")}};window.ExploreRenderer=e;window.addEventListener("langChanged",()=>{e.state.hasLoadedOnce=!1,e.renderDynamicFilters(),e.renderPage()});
