navigator.serviceWorker.getRegistrations().then(e=>{e.forEach(t=>{t.unregister()})});"caches"in window&&caches.keys().then(e=>{e.forEach(t=>{caches.delete(t)})});const p={it:window.i18nIt,en:window.i18nEn};let f="it";function u(e,t){if(!e||!t)return null;const n=t.split(".");let i=e;for(let a=0;a<n.length;a+=1){const o=n[a];if(i&&Object.prototype.hasOwnProperty.call(i,o))i=i[o];else return null}return i}function k(e){const t=p[e];if(!t)return;document.querySelectorAll("[data-i18n]").forEach(o=>{const r=o.getAttribute("data-i18n"),s=u(t,r);typeof s=="string"&&(o.textContent=s)}),document.querySelectorAll("[data-img]").forEach(o=>{const r=o.getAttribute("data-img"),s=u(t,r);typeof s=="string"&&(o.src=s)}),document.querySelectorAll("[data-landing-img]").forEach(o=>{const r=o.getAttribute("data-landing-img");if(window.ImagePaths){const s=u(window.ImagePaths,r);typeof s=="string"&&(o.src=s)}})}function L(e){if(f=e,document.documentElement.lang=e,localStorage.setItem("fabio_lang",e),localStorage.setItem("preferredLanguage",e),k(e),window.dispatchEvent(new CustomEvent("langChanged",{detail:{lang:e}})),document.getElementById("servicesFlow")&&(w("servicesFlow","secrets.page2.services",E),w("rules-page3","secrets.page3.rules",E),w("packing-checklist","secrets.page4.items",B),w("adventuresGrid","secrets.page6.items",P),C(),T(e)),window.PromoBanner&&window.appData&&window.appData.Global_Settings&&window.PromoBanner.render(window.appData.Global_Settings),typeof window.renderLegal=="function")try{window.renderLegal(e)}catch{}window.AOS&&window.AOS.refreshHard()}function w(e,t,n){const i=document.getElementById(e);if(!i)return;const a=p[f];if(!a)return;const o=u(a,t);if(i.innerHTML="",Array.isArray(o)){const r=document.createDocumentFragment();o.forEach((s,c)=>{const l=n(s,c,a);if(!l)return;const d=document.createElement("div");for(d.innerHTML=l.trim();d.firstChild;)r.appendChild(d.firstChild)}),i.appendChild(r)}else if(o&&typeof o=="object"){const r=n(o,0,a);if(r){const s=document.createElement("div");for(s.innerHTML=r.trim();s.firstChild;)i.appendChild(s.firstChild)}}window.AOS&&window.AOS.refreshHard()}function E(e,t){if(!e)return"";const n=t===0?0:t*80,i=String(n),a=typeof e.img=="string"?e.img:"",o=e.title||e.name||"",r=e.desc||"",s=e.extra_title||"",c=e.extra_desc||"",d=s||c?`
      <div class="catalog-card-extra">
        ${s?`<h4 class="catalog-card-extra-title">${s}</h4>`:""}
        ${c?`<p class="catalog-card-extra-desc">${c}</p>`:""}
      </div>
    `:"";return`
    <article class="catalog-card" data-aos="fade-up"${i!=="0"?` data-aos-delay="${i}"`:""}>
      <div class="catalog-card-main">
        <h3 class="catalog-card-title">${o}</h3>
        <p class="catalog-card-desc">${r}</p>
      </div>
      <div class="catalog-card-image">
        <img src="${a}" alt="${o}" class="catalog-card-img" loading="lazy">
      </div>
      ${d}
    </article>
  `}function B(e){if(!e)return"";const t=typeof e.icon=="string"?e.icon:"";return`
    <div class="checklist-item" data-aos="zoom-in">
      <div class="checklist-icon">
        <i class="${t?`fa-solid ${t} checklist-icon-glyph`:"fa-solid fa-circle checklist-icon-glyph"}" aria-hidden="true"></i>
      </div>
      <div class="checklist-text">
        <h4>${e.title||""}</h4>
        <p>${e.desc||""}</p>
      </div>
    </div>
  `}function P(e,t){if(!e)return"";const n=typeof e.img=="string"?e.img:"";return`
    <div class="swiper-slide">
      <button type="button" class="adventure-card" data-index="${String(t)}" data-aos="zoom-in">
        <img src="${n}" class="adventure-photo" alt="" loading="lazy" decoding="async">
        <div class="adventure-caption">${e.cap||""}</div>
      </button>
    </div>
  `}let y=null;function C(){y&&y.destroy(!0,!0),document.querySelector(".adventures-slider")&&(y=new Swiper(".adventures-slider",{loop:!0,centeredSlides:!0,grabCursor:!0,slidesPerView:1,spaceBetween:20,speed:600,autoplay:{delay:3500,disableOnInteraction:!1,pauseOnMouseEnter:!0},pagination:{el:".swiper-pagination",clickable:!0},breakpoints:{640:{slidesPerView:1.5},768:{slidesPerView:2},1024:{slidesPerView:3}}}))}function $(e){const t=document.querySelector(e);if(!t)return;const n=80,i=t.getBoundingClientRect(),a=window.scrollY+i.top-n;window.scrollTo({top:a,behavior:"smooth"})}function A(){const e=document.getElementById("indexMenu");e&&e.classList.add("is-visible")}function v(){const e=document.getElementById("indexMenu");e&&e.classList.remove("is-visible")}function T(e){const t=p[e];if(!t)return;const n=document.getElementById("indexMenu");if(!n)return;const i=n.querySelector(".index-menu-nav");if(!i)return;const a=[{id:"#page1",key:"secrets.page1.headline"},{id:"#page2",key:"secrets.page2.headline"},{id:"#page3",key:"secrets.page3.headline"},{id:"#page4",key:"secrets.page4.list_title"},{id:"#page5",key:"secrets.page5.highlight"},{id:"#page6",key:"secrets.page6.title"}];i.innerHTML="",a.forEach((o,r)=>{const s=u(t,o.key),c=document.createElement("button");c.type="button",c.className="index-link",typeof s=="string"?c.textContent=`${r+1} Â· ${s}`:c.textContent=`Section ${r+1}`,c.addEventListener("click",()=>{v(),$(o.id)}),i.appendChild(c)})}function M(){const e=document.getElementById("indexToggle"),t=document.getElementById("indexMenu");if(!e||!t)return;const n=t.querySelector(".index-menu-close");e.addEventListener("click",()=>{A()}),n&&n.addEventListener("click",()=>{v()}),t.addEventListener("click",i=>{i.target===t&&v()})}function D(){const e=document.getElementById("adventuresModal"),t=document.getElementById("adventuresModalImage"),n=document.getElementById("adventuresModalCaption");if(!e||!t||!n)return;const i=e.querySelector(".adventures-modal-close"),a=document.getElementById("adventuresGrid");a&&a.addEventListener("click",r=>{const c=r.target.closest(".adventure-card");if(!c)return;const l=c.getAttribute("data-index"),d=l?parseInt(l,10):0,m=p[f],h=m&&m.secrets&&m.secrets.page6,I=h&&Array.isArray(h.items)?h.items:[],g=I[d]||I[0],x=g&&typeof g.img=="string"?g.img:"";t.src=x,n.textContent=g&&g.cap?g.cap:"",e.classList.add("is-visible")});function o(){e.classList.remove("is-visible")}i&&i.addEventListener("click",()=>{o()}),e.addEventListener("click",r=>{r.target===e&&o()})}function O(){if(!window.ImagePaths||!window.ImagePaths.secrets||!window.ImagePaths.secrets.bg)return;const e=window.ImagePaths.secrets.bg,t=(n,i)=>{const a=document.querySelector(n);a&&a.style.setProperty("--bg-image",`url('${i}')`)};t(".section-hero",e.hero),t(".section-2",e.sec2),t(".section-3",e.sec3),t(".section-4",e.sec4),t(".section-5",e.sec5),t(".section-6",e.sec6)}function _(){window.AOS&&window.AOS.init({once:!0,duration:800,easing:"ease-out-cubic",offset:100})}const b={init:async()=>{window.UILayout&&window.UILayout.init(),"serviceWorker"in navigator&&navigator.serviceWorker.getRegistrations().then(function(a){for(let o of a)o.unregister()});const e=localStorage.getItem("fabio_lang"),t=localStorage.getItem("preferredLanguage"),n=e||t||"it";p[n]&&(f=n),L(f),document.getElementById("trips-grid")?await b.initTripCatalog():b.initSharmSecrets(),_();const i=document.getElementById("who-fabio");if(i&&window.WhoFabioParallax)try{window.WFParallax=window.WFParallax||new window.WhoFabioParallax(i)}catch{}},initTripCatalog:async()=>{if(document.getElementById("trips-grid"),window.api&&window.api.fetchAllData){const t=await window.api.fetchAllData();if(!t){console.error("App: Data fetch returned null.");return}if(window.appData=t,window.PromoBanner&&t.Global_Settings&&window.PromoBanner.render(t.Global_Settings),window.UILayout&&window.UILayout.init(),!window.TripsRenderer||!t.Trips_Prices){const n=document.getElementById("trips-grid");if(n){const a=(localStorage.getItem("fabio_lang")||document.documentElement.lang||"it")==="en"?window.i18nEn||{}:window.i18nIt||{},o=a.global&&typeof a.global.loading_failed=="string"?a.global.loading_failed:"";n.innerHTML=`<div class="col-span-full text-center py-12">
                <p class="text-gold text-xl" data-i18n="global.loading_failed">${o}</p>
            </div>`}}S()}else console.error("API module not found")},initSharmSecrets:()=>{O(),M(),D(),S()}};function S(){const e=document.getElementById("global-footer")||document.querySelector("footer");if(!e)return;new IntersectionObserver(n=>{n.forEach(i=>{i.isIntersecting?document.body.classList.add("hide-floating-widgets"):document.body.classList.remove("hide-floating-widgets")})},{root:null,threshold:.1}).observe(e)}window.appData=window.appData||{};window.appData.openBooking=e=>{const t="201063239261",n=`Ciao Fabio! I want to book trip: ${e}`;window.open(`https://wa.me/${t}?text=${encodeURIComponent(n)}`,"_blank")};document.addEventListener("DOMContentLoaded",()=>{b.init()});
