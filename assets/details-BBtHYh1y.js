import"./global-header-CNxNu7ut.js";import"./ui-layout-BzRTcNJb.js";import"./booking-manager-mPVp2E2z.js";const a={init:async()=>{const e=new URLSearchParams(window.location.search).get("id");sessionStorage.setItem("fabio_nav_source","details");const o=document.getElementById("whatsapp-float");o&&o.remove();const t=document.querySelector(".wa-fab-label");if(t&&t.remove(),!e){window.location.href="index.html";return}typeof a.renderGalleryImmediate=="function"&&a.renderGalleryImmediate(e);const l=localStorage.getItem("fabio_lang")||document.documentElement.lang||"it",s=l==="en"?window.i18nEn||{}:window.i18nIt||{},d=s.trips?s.trips[e]:null;let m=null;const c=sessionStorage.getItem("fabio_data_cache");if(c)try{const r=JSON.parse(c);m=(Array.isArray(r)?r:r.Trips_Prices||[]).find(w=>w.trip_id===e)}catch{}if(m||d){if(m)a.render(e,m,d,l);else if(a.renderStaticFirst(e,d,l),window.api&&window.api.fetchAllData){const r=await window.api.fetchAllData();sessionStorage.setItem("fabio_data_cache",JSON.stringify(r));const w=(r.Trips_Prices||[]).find(b=>b.trip_id===e);w&&a.updatePriceOnly(w)}}else{const r=l==="en"?window.i18nEn||{}:window.i18nIt||{},u=r&&r.global&&typeof r.global.experience_not_found=="string"?r.global.experience_not_found:"";document.querySelector("main").innerHTML=`
                <div class="h-screen flex items-center justify-center text-white">
                    <h1 class="text-3xl font-playfair text-gold" data-i18n="global.experience_not_found">${u}</h1>
                </div>
            `}},state:{apiData:null,langData:null,lang:"it",tripId:""},render:(n,e,o,t)=>{const l=localStorage.getItem("fabio_lang")||document.documentElement.lang||"it",s=l==="en"?window.i18nEn||{}:window.i18nIt||{},d=s.trips?s.trips[n]:null;t=l,o=d||o;const m=o&&o.title||e&&e.trip_id||n,c=e?parseFloat(e.p_adult||"0"):0,r=e?parseFloat(e.d_adult||"0"):0,u=e?parseFloat(e.p_child||"0"):0,w=e?parseFloat(e.d_child||"0"):0,b=e?parseInt(e.min_pax||"1",10):1,f=e?t==="en"?e.badge_en:e.badge_it:"";document.title=`Fabio Tours | ${m}`;const B=document.querySelector('meta[name="description"]')||(function(){const g=document.createElement("meta");return g.setAttribute("name","description"),document.head.appendChild(g),g})(),x=o&&o.short_desc||o&&o.full_description||"",p=typeof x=="string"?x.replace(/\s+/g," ").trim().slice(0,200):"";B&&B.setAttribute("content",p);const i={bg:document.getElementById("hero-bg"),title:document.getElementById("detail-title"),badge:document.getElementById("detail-badge"),duration:document.getElementById("detail-duration"),price:document.getElementById("detail-price"),desc:document.getElementById("detail-desc"),highlights:document.getElementById("detail-highlights"),fullDesc:document.getElementById("detail-full-desc"),program:document.getElementById("detail-program"),important:document.getElementById("detail-important"),cardPrice:document.getElementById("card-price"),includes:document.getElementById("detail-includes"),excludes:document.getElementById("detail-excludes"),gallery:document.getElementById("gallery-grid"),btnBook:document.getElementById("btn-submit-booking")||document.getElementById("btn-book")},$=(typeof window<"u"&&window.location&&window.location.pathname?window.location.pathname.split("/"):[]).filter(Boolean)[0]||"",M=$?`/${$}/`:"/",A=typeof window<"u"&&window.FABIO_BASE_URL||M,_=window.ImagePaths?window.ImagePaths.resolveTripContext({trip_id:n,...e||{}}):{location:"",category:""},k=window.ImagePaths?window.ImagePaths.getPoster(_.location,_.category,n):`${A}assets/images/trips/${n}/poster.webp`,H=window.ImagePaths?window.ImagePaths.ui.fallbackLogo:`${A}assets/images/logo/logo-fabio-square.webp`;if(i.bg)if(i.bg.style.backgroundImage=`url('${k}')`,window.ImagePaths&&typeof window.ImagePaths.resolvePosterOrPlaceholder=="function")window.ImagePaths.resolvePosterOrPlaceholder(_.location,_.category,n).then(g=>{i.bg.style.backgroundImage=`url('${g}')`});else{const g=new Image;g.src=k,g.onerror=()=>{i.bg.style.backgroundImage=`url('${H}')`}}i.title&&(i.title.textContent=m),i.badge&&(f?(i.badge.textContent=f,i.badge.style.display="inline-block"):i.badge.style.display="none");const R=r>0?`<span class="inline-flex items-center gap-2"><span>ðŸ‘¤</span><span class="line-through text-gray-400">â‚¬${c}</span><span class="text-gold font-bold">â‚¬${r}</span></span>`:`<span class="inline-flex items-center gap-2"><span>ðŸ‘¤</span><span class="text-gold font-bold">â‚¬${c}</span></span>`;i.price&&(i.price.innerHTML=R);const L=r>0?r:c;i.cardPrice&&(i.cardPrice.textContent=`â‚¬${L}`);const S=document.getElementById("live-total-price");S&&(S.textContent=`â‚¬${L}`);const T=document.getElementById("card-price-breakdown");if(T){const h=(s&&s.global&&s.global.pricing?s.global.pricing:{}).min_pax||"Min Pax",y=r>0?`<div class="flex items-center gap-2"><span>ðŸ‘¤</span><span class="line-through text-gray-400">â‚¬${c}</span><span class="text-white font-bold">â‚¬${r}</span></div>`:`<div class="flex items-center gap-2"><span>ðŸ‘¤</span><span class="text-white font-bold">â‚¬${c}</span></div>`,I=w>0||u>0?w>0?`<div class="flex items-center gap-2"><span>ðŸ‘¶</span><span class="line-through text-gray-400">â‚¬${u}</span><span class="text-white font-bold">â‚¬${w}</span></div>`:`<div class="flex items-center gap-2"><span>ðŸ‘¶</span><span class="text-white font-bold">â‚¬${u}</span></div>`:"",E=`<div class="flex items-center gap-2"><span>ðŸ‘¥</span><span class="text-gray-300">${h}: ${b}</span></div>`;T.innerHTML=`${y}${I||""}${E}`}if(o){const g=t==="en"?window.i18nEn||{}:window.i18nIt||{},h=g&&g.global&&typeof g.global.daily=="string"?g.global.daily:"";i.duration&&(i.duration.textContent=o.duration||h),i.desc&&(i.desc.innerHTML=o.short_desc||""),i.fullDesc&&(i.fullDesc.innerHTML=o.full_description||""),i.important&&(i.important.textContent=o.important_notes||""),a.renderList(i.highlights,o.highlights),a.renderList(i.includes,o.includes,!0,"check"),a.renderList(i.excludes,o.not_included,!0,"cross"),i.program&&o.program&&a.renderProgram(i.program,o.program)}const v=t==="en"?window.i18nEn||{}:window.i18nIt||{},G=v&&v.global&&typeof v.global.book_now=="string"?v.global.book_now:"";i.btnBook&&(i.btnBook.textContent=G);const C=document.getElementById("sticky-mobile-book");if(C&&(setTimeout(()=>{C.classList.remove("translate-y-32")},200),a.setupStickyBehavior()),i.gallery&&i.gallery.children.length===0){const g=window.ImagePaths&&typeof window.ImagePaths.pickCI=="function"?window.ImagePaths.pickCI(e||{},"img_count"):"",h=parseInt(g||"0",10),y=window.ImagePaths&&typeof window.ImagePaths.getGalleryArray=="function"?window.ImagePaths.getGalleryArray(_.location,_.category,n,h):[];a.appendGalleryItem(k,i.gallery,i.bg),Array.isArray(y)&&y.length>0&&y.forEach(I=>a.appendGalleryItem(I,i.gallery,i.bg))}try{const g=sessionStorage.getItem("fabio_data_cache")||sessionStorage.getItem("fabio_trips_cache");let h=[];if(g){const y=JSON.parse(g),I=y&&Array.isArray(y.Trip_Addons)?y.Trip_Addons:[];h=Array.isArray(I)?I.filter(E=>String(E.trip_id||"")===n):[]}a.state.apiData=e,a.state.langData=o,a.state.lang=t,a.state.tripId=n,window.BookingManager&&window.BookingManager.init(n,e,o,h)}catch{a.state.apiData=e,a.state.langData=o,a.state.lang=t,a.state.tripId=n,window.BookingManager&&window.BookingManager.init(n,e,o,[])}},setupStickyBehavior:()=>{const n=document.getElementById("sticky-mobile-book"),e=document.getElementById("booking-card-container");if(!n||!e)return;const o=n.querySelector('span[data-i18n="global.book_now"]');setInterval(()=>{o&&(o.classList.add("animate-wiggle"),setTimeout(()=>o.classList.remove("animate-wiggle"),1200))},8e3),new IntersectionObserver(s=>{const d=s[0];d&&d.isIntersecting&&d.intersectionRatio>.2?(n.classList.add("opacity-0","pointer-events-none"),n.classList.remove("opacity-100")):(n.classList.add("opacity-100"),n.classList.remove("opacity-0","pointer-events-none"))},{root:null,threshold:[0,.2,.5,1]}).observe(e)},renderStaticFirst:(n,e,o)=>{const t={bg:document.getElementById("hero-bg"),title:document.getElementById("detail-title"),badge:document.getElementById("detail-badge"),duration:document.getElementById("detail-duration"),price:document.getElementById("detail-price"),desc:document.getElementById("detail-desc"),highlights:document.getElementById("detail-highlights"),fullDesc:document.getElementById("detail-full-desc"),program:document.getElementById("detail-program"),important:document.getElementById("detail-important"),cardPrice:document.getElementById("card-price"),cardBreakdown:document.getElementById("card-price-breakdown"),includes:document.getElementById("detail-includes"),excludes:document.getElementById("detail-excludes"),gallery:document.getElementById("gallery-grid"),btnBook:document.getElementById("btn-submit-booking")||document.getElementById("btn-book")},s=(typeof window<"u"&&window.location&&window.location.pathname?window.location.pathname.split("/"):[]).filter(Boolean)[0]||"",d=s?`/${s}/`:"/",m=typeof window<"u"&&window.FABIO_BASE_URL||d,c=window.ImagePaths?window.ImagePaths.resolveTripContext({trip_id:n}):{location:"",category:""},r=window.ImagePaths?window.ImagePaths.getPoster(c.location,c.category,n):`${m}assets/images/trips/${n}/poster.webp`,u=window.ImagePaths?window.ImagePaths.ui.fallbackLogo:`${m}assets/images/logo/logo-fabio-square.webp`;if(t.bg)if(t.bg.style.backgroundImage=`url('${r}')`,window.ImagePaths&&typeof window.ImagePaths.resolvePosterOrPlaceholder=="function")window.ImagePaths.resolvePosterOrPlaceholder(c.location,c.category,n).then(p=>{t.bg.style.backgroundImage=`url('${p}')`});else{const p=new Image;p.src=r,p.onerror=()=>{t.bg.style.backgroundImage=`url('${u}')`}}const w=e&&e.title||n;t.title&&(t.title.textContent=w),t.price&&(t.price.innerHTML='<span class="price-skeleton inline-block"></span>'),t.cardPrice&&(t.cardPrice.innerHTML='<span class="price-skeleton inline-block"></span>'),t.cardBreakdown&&(t.cardBreakdown.innerHTML='<div class="price-skeleton" style="width: 80%; height: 1.2rem;"></div>');const b=document.getElementById("live-total-price");if(b&&(b.textContent="â‚¬0"),e){const p=o==="en"?window.i18nEn||{}:window.i18nIt||{},i=p&&p.global&&typeof p.global.daily=="string"?p.global.daily:"";t.duration&&(t.duration.textContent=e.duration||i),t.desc&&(t.desc.innerHTML=e.short_desc||""),t.fullDesc&&(t.fullDesc.innerHTML=e.full_description||""),t.important&&(t.important.textContent=e.important_notes||""),a.renderList(t.highlights,e.highlights),a.renderList(t.includes,e.includes,!0,"check"),a.renderList(t.excludes,e.not_included,!0,"cross"),t.program&&e.program&&a.renderProgram(t.program,e.program)}if(t.gallery&&t.gallery.children.length===0){const p=window.ImagePaths&&typeof window.ImagePaths.getGalleryArray=="function"?window.ImagePaths.getGalleryArray(c.location,c.category,n,0):[];a.appendGalleryItem(r,t.gallery,t.bg),Array.isArray(p)&&p.length>0&&p.forEach(i=>a.appendGalleryItem(i,t.gallery,t.bg))}const f=o==="en"?window.i18nEn||{}:window.i18nIt||{},B=f&&f.global&&typeof f.global.book_now=="string"?f.global.book_now:"";t.btnBook&&(t.btnBook.textContent=B);const x=document.getElementById("sticky-mobile-book");x&&setTimeout(()=>{x.classList.remove("translate-y-32")},200)},updatePriceOnly:n=>{const e=document.getElementById("detail-price"),o=document.getElementById("card-price"),t=document.getElementById("card-price-breakdown"),l=parseFloat(n.p_adult||"0"),s=parseFloat(n.d_adult||"0"),d=parseFloat(n.p_child||"0"),m=parseFloat(n.d_child||"0"),c=parseInt(n.min_pax||"1",10),r=s>0?`<span class="inline-flex items-center gap-2"><span>ðŸ‘¤</span><span class="line-through text-gray-400">â‚¬${l}</span><span class="text-gold font-bold">â‚¬${s}</span></span>`:`<span class="inline-flex items-center gap-2"><span>ðŸ‘¤</span><span class="text-gold font-bold">â‚¬${l}</span></span>`;e&&(e.innerHTML=r);const u=s>0?s:l;o&&(o.textContent=`â‚¬${u}`);const w=document.getElementById("live-total-price");if(w&&(w.textContent=`â‚¬${u}`),a.state.apiData=n,window.BookingManager&&(BookingManager.state.apiData=n,BookingManager.calculateTotal()),t){const f=(localStorage.getItem("fabio_lang")||document.documentElement.lang||"it")==="en"?window.i18nEn||{}:window.i18nIt||{},x=(f&&f.global&&f.global.pricing?f.global.pricing:{}).min_pax||"Min Pax",p=s>0?`<div class="flex items-center gap-2"><span>ðŸ‘¤</span><span class="line-through text-gray-400">â‚¬${l}</span><span class="text-white font-bold">â‚¬${s}</span></div>`:`<div class="flex items-center gap-2"><span>ðŸ‘¤</span><span class="text-white font-bold">â‚¬${l}</span></div>`,i=m>0||d>0?m>0?`<div class="flex items-center gap-2"><span>ðŸ‘¶</span><span class="line-through text-gray-400">â‚¬${d}</span><span class="text-white font-bold">â‚¬${m}</span></div>`:`<div class="flex items-center gap-2"><span>ðŸ‘¶</span><span class="text-white font-bold">â‚¬${d}</span></div>`:"",P=`<div class="flex items-center gap-2"><span>ðŸ‘¥</span><span class="text-gray-300">${x}: ${c}</span></div>`;t.innerHTML=`${p}${i||""}${P}`}},renderGalleryImmediate:n=>{const e={gallery:document.getElementById("gallery-grid"),bg:document.getElementById("hero-bg")};if(!e.gallery)return;const o=window.ImagePaths?window.ImagePaths.resolveTripContext({trip_id:n}):{location:"",category:""},l=(typeof window<"u"&&window.location&&window.location.pathname?window.location.pathname.split("/"):[]).filter(Boolean)[0]||"",s=l?`/${l}/`:"/",d=typeof window<"u"&&window.FABIO_BASE_URL||s,m=window.ImagePaths?window.ImagePaths.getPoster(o.location,o.category,n):`${d}assets/images/trips/${n}/poster.webp`;e.gallery.innerHTML="",a.appendGalleryItem(m,e.gallery,e.bg);const c=window.ImagePaths&&typeof window.ImagePaths.getGalleryArray=="function"?window.ImagePaths.getGalleryArray(o.location,o.category,n,0):[];Array.isArray(c)&&c.length>0&&c.forEach(r=>a.appendGalleryItem(r,e.gallery,e.bg))},appendGalleryItem:(n,e,o)=>{if(Array.from(e.querySelectorAll("img")).some(s=>s.getAttribute("src")===n))return;const l=document.createElement("div");l.className="flex-shrink-0 w-32 h-32 md:w-40 md:h-40 aspect-square rounded-xl overflow-hidden cursor-pointer relative group border border-gray-100 shadow-md snap-center",l.innerHTML=`
            <img src="${n}" class="w-full h-full object-cover transform transition-transform duration-700 group-hover:scale-110">
            <div class="absolute inset-0 bg-black/20 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center">
                <svg class="w-8 h-8 text-white drop-shadow-lg" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
            </div>
        `,l.onclick=()=>{o&&(o.style.backgroundImage=`url('${n}')`,window.scrollTo({top:0,behavior:"smooth"}))},e.appendChild(l)},renderList:(n,e,o=!1,t="check")=>{!e||!Array.isArray(e)||!n||(n.innerHTML=e.map(l=>`
            <li class="flex items-start leading-relaxed border-b border-gray-100 pb-2 last:border-0">
                ${o?t==="check"?'<span class="text-gold mr-3 font-bold">âœ“</span>':'<span class="text-gray-400 mr-3 font-bold">Ã—</span>':'<span class="text-gold mr-3 text-xl">â€¢</span>'}
                <span class="${o?n.id==="detail-highlights"?"text-white text-sm":"text-gray-600 text-sm":n.id==="detail-highlights"?"text-white font-medium":"text-gray-800 font-medium"}">${l}</span>
            </li>
            `).join(""))},renderProgram:(n,e)=>{if(!e||!Array.isArray(e)||!n)return;const o=e.map((t,l)=>{const s=t&&typeof t=="object",d=s&&t.time||"",m=s&&t.activity||"",c=s?t.details||"":String(t||"");return`
                <div class="flex gap-4 mb-6 last:mb-0 relative">
                    <div class="flex flex-col items-center">
                        <div class="w-8 h-8 rounded-full bg-gold text-white flex items-center justify-center font-bold text-sm shadow-lg z-10">
                            ${l+1}
                        </div>
                        ${l!==e.length-1?'<div class="w-0.5 h-full bg-gray-100 absolute top-8"></div>':""}
                    </div>
                    <div class="pb-2">
                        ${d?`<div class="text-sm text-gray-500 mb-1">${d}</div>`:""}
                        ${m?`<div class="text-white font-semibold mb-1">${m}</div>`:""}
                        <p class="text-gray-300 leading-relaxed">${c}</p>
                    </div>
                </div>
            `}).join("");n.innerHTML=o}};window.DetailsRenderer=a;window.addEventListener("langChanged",()=>{window.DetailsRenderer&&typeof window.DetailsRenderer.init=="function"&&window.DetailsRenderer.init()});
