import"./global-header-B4AxPn_2.js";import"./ui-layout-YpVXqCmA.js";import"./booking-manager-mPVp2E2z.js";import"./global-footer-D0aab2x-.js";const b={loadAll:async()=>{if(!window.api||typeof window.api.fetchAllData!="function")return null;const e=await window.api.fetchAllData(),o=Array.isArray(e.Packages)?e.Packages:[],n=Array.isArray(e.Trips_Prices)?e.Trips_Prices:[],s=Array.isArray(e.Trip_Addons)?e.Trip_Addons:[];return{packagesList:o,tripsList:n,addonsList:s}}};window.PackagesService=b;const p={state:{packageId:"",apiData:null,langData:null,lang:"it",allTrips:[],includedTrips:[],intervals:[]},getLang:()=>{const e=localStorage.getItem("fabio_lang"),o=document.documentElement.lang;return e||o||"it"},getI18n:e=>e==="en"?window.i18nEn||{}:window.i18nIt||{},findPackageById:(e,o)=>{if(!Array.isArray(e))return null;const n=String(o||"").trim();return e.find(s=>{const t=String(s.package_id||"").trim(),a=String(s.trip_id||"").trim();return t===n||a===n})||null},setStateFromData:(e,o,n,s)=>{const t=e&&(e.trip_id||e.package_id)||"";p.state.packageId=t,p.state.apiData=e||null,p.state.langData=n||null,p.state.lang=s||"it",p.state.allTrips=Array.isArray(o)?o:[]},setIncludedTrips:e=>{p.state.includedTrips=Array.isArray(e)?e:[]},clearIntervals:()=>{Array.isArray(p.state.intervals)&&p.state.intervals.forEach(e=>{clearInterval(e)}),p.state.intervals=[]},addInterval:e=>{p.state.intervals.push(e)},prepareIncludedTripItems:(e,o,n)=>{const s=n&&n.trips||{},t=[];return Array.isArray(e)&&e.forEach(a=>{const i=String(a||"").trim();if(!i)return;const r=Array.isArray(o)?o.find(c=>String(c.trip_id||"").trim()===i):null,l=s[i]||null;!r&&!l||t.push({id:i,apiTrip:r,langTrip:l})}),t}};window.PackagesModel=p;const d={renderNotFound:(e,o)=>{const n=e.global||{},s=typeof n.experience_not_found=="string"?n.experience_not_found:o==="en"?"Package not found.":"Pacchetto non trovato.",t=document.querySelector("main");t&&(t.innerHTML='<div class="h-screen flex items-center justify-center text-white"><h1 class="text-3xl font-playfair text-gold" data-i18n="global.experience_not_found">'+s+"</h1></div>")},renderPackageShell:(e,o)=>{const n=e.apiData,s=e.langData,t=e.packageId,a=e.lang,r=(o||(a==="en"?window.i18nEn||{}:window.i18nIt||{})).global||{};d.setupSEO(s,t);const l=String(n&&n.type||"package").toLowerCase()==="package",c=d.resolvePackageImages(n,t,l);d.setupHero(c.posterSrc,c.ctx,l,t),d.renderBasicDetails(s,n,r,t),d.renderMainPrice(n,r),d.setupGallery(n,c,t)},setupSEO:(e,o)=>{const n=e&&e.title||o;document.title="Fabio Tours | "+n;const s=document.querySelector('meta[name="description"]')||(function(){const l=document.createElement("meta");return l.setAttribute("name","description"),document.head.appendChild(l),l})(),t=e&&(e.short_desc||e.full_description)||"",a=typeof t=="string"?t.replace(/\s+/g," ").trim().slice(0,200):"";s.setAttribute("content",a);const i=document.querySelector('meta[name="keywords"]')||(function(){const l=document.createElement("meta");return l.setAttribute("name","keywords"),document.head.appendChild(l),l})(),r=Array.isArray(e&&e.seo_tags)?e.seo_tags:[];i.setAttribute("content",r.join(", "))},resolvePackageImages:(e,o,n)=>{let s={location:"",category:"",tripId:o},t="";if(n){const a=e&&(e.location||e.category||"sharm")||"sharm",i=String(a).toLowerCase().trim();t=window.ImagePaths&&typeof window.ImagePaths.getPackagePoster=="function"?window.ImagePaths.getPackagePoster(i,o):"assets/images/packages/"+i+"/"+o+"/poster.webp"}else s=window.ImagePaths?window.ImagePaths.resolveTripContext({trip_id:o,...e||{}}):{location:"",category:"",tripId:o},t=window.ImagePaths?window.ImagePaths.getPoster(s.location,s.category,o):"assets/images/trips/"+o+"/poster.webp";return{posterSrc:t,ctx:s}},setupHero:(e,o,n,s)=>{const t=document.getElementById("hero-bg"),a=window.ImagePaths?window.ImagePaths.ui.fallbackLogo:"assets/images/logo/logo-fabio-square.webp";if(t)if(t.style.backgroundImage="url('"+e+"')",!n&&window.ImagePaths&&typeof window.ImagePaths.resolvePosterOrPlaceholder=="function")window.ImagePaths.resolvePosterOrPlaceholder(o.location,o.category,s).then(i=>{t.style.backgroundImage="url('"+i+"')"});else{const i=new Image;i.src=e,i.onerror=()=>{t.style.backgroundImage="url('"+a+"')"}}},renderBasicDetails:(e,o,n,s)=>{const t={title:document.getElementById("detail-title"),badge:document.getElementById("detail-badge"),duration:document.getElementById("detail-duration"),desc:document.getElementById("detail-desc"),fullDesc:document.getElementById("detail-full-desc"),important:document.getElementById("detail-important"),highlights:document.getElementById("detail-highlights"),includes:document.getElementById("detail-includes"),excludes:document.getElementById("detail-excludes"),program:document.getElementById("detail-program")},a=e&&e.title||s;t.title&&(t.title.textContent=a);const i=n.badges||{};let r="";if(o&&o.badge_key){const l=String(o.badge_key).trim();r=i[l]||i[l.toUpperCase()]||i[l.toLowerCase()]||""}if(t.badge&&(t.badge.textContent=r,t.badge.style.display=r?"inline-block":"none"),e){const l=typeof n.daily=="string"?n.daily:"";t.duration&&(t.duration.textContent=e.duration||l),t.desc&&(t.desc.innerHTML=e.short_desc||""),t.fullDesc&&(t.fullDesc.innerHTML=e.full_description||""),t.important&&(t.important.textContent=e.important_notes||""),d.renderList(t.highlights,e.highlights),d.renderList(t.includes,e.includes,!0),d.renderList(t.excludes,e.not_included,!0),t.program&&e.program&&d.renderProgram(t.program,e.program)}},renderMainPrice:(e,o)=>{const n=e?parseFloat(e.p_adult||"0"):0,s=e?parseFloat(e.d_adult||"0"):0,t=e?parseFloat(e.p_child||"0"):0,a=e?parseFloat(e.d_child||"0"):0,i=e?parseInt(e.min_pax||"1",10):1,r=document.getElementById("detail-price"),l=s>0?'<span class="inline-flex items-center gap-2"><span>ðŸ‘¤</span><span class="line-through text-gray-400">â‚¬'+n+'</span><span class="text-gold font-bold">â‚¬'+s+"</span></span>":'<span class="inline-flex items-center gap-2"><span>ðŸ‘¤</span><span class="text-gold font-bold">â‚¬'+n+"</span></span>";r&&(r.innerHTML=l);const c=s>0?s:n,g=document.getElementById("card-price");g&&(g.textContent="â‚¬"+c);const u=document.getElementById("live-total-price");u&&(u.textContent="â‚¬"+c);const m=document.getElementById("card-price-breakdown");if(m){const f=(o.pricing||{}).min_pax||"Min Pax",w=s>0?'<div class="flex items-center gap-2"><span>ðŸ‘¤</span><span class="line-through text-gray-400">â‚¬'+n+'</span><span class="text-white font-bold">â‚¬'+s+"</span></div>":'<div class="flex items-center gap-2"><span>ðŸ‘¤</span><span class="text-white font-bold">â‚¬'+n+"</span></div>",h=a>0||t>0?a>0?'<div class="flex items-center gap-2"><span>ðŸ‘¶</span><span class="line-through text-gray-400">â‚¬'+t+'</span><span class="text-white font-bold">â‚¬'+a+"</span></div>":'<div class="flex items-center gap-2"><span>ðŸ‘¶</span><span class="text-white font-bold">â‚¬'+t+"</span></div>":"",x='<div class="flex items-center gap-2"><span>ðŸ‘¥</span><span class="text-gray-300">'+f+": "+i+"</span></div>";m.innerHTML=w+h+x}},setupGallery:(e,o,n)=>{const s=document.getElementById("gallery-grid"),t=document.getElementById("hero-bg");if(!s||s.children.length>0)return;const a=o.ctx,i=o.posterSrc,r=window.ImagePaths&&typeof window.ImagePaths.pickCI=="function"?window.ImagePaths.pickCI(e||{},"img_count"):"",l=parseInt(r||"0",10),c=window.ImagePaths&&typeof window.ImagePaths.getGalleryArray=="function"?window.ImagePaths.getGalleryArray(a.location,a.category,n,l):[];d.createGalleryThumb(i,s,t,"w-40 h-24"),Array.isArray(c)&&c.length>0&&c.forEach(g=>{d.createGalleryThumb(g,s,t,"w-40 h-24")})},setupStickyBar:()=>{const e=document.getElementById("sticky-mobile-book");e&&(setTimeout(()=>{e.classList.remove("translate-y-32")},200),d.setupStickyBehavior())},renderIncludedTrips:(e,o,n)=>{d.clearIncludedTrips();const s=document.getElementById("included-trips-grid"),t=document.getElementById("included-trips-subtitle");if(!s)return;const a=Array.isArray(e&&e.included_trip_ids)?e.included_trip_ids:[];if(!a.length){t&&(t.textContent="");return}d.setIncludedTripsSubtitle(t,n);const i=PackagesModel.prepareIncludedTripItems(a,o,n);PackagesModel.setIncludedTrips(i);const r=document.createDocumentFragment(),l=n.global||{};i.forEach(c=>{d.renderIncludedTripCard(c,r,l)}),s.appendChild(r)},clearIncludedTrips:()=>{PackagesModel.clearIntervals();const e=document.getElementById("included-trips-grid");e&&(e.innerHTML="")},setIncludedTripsSubtitle:(e,o)=>{if(!e)return;const s=PackagesModel.state.lang==="en"?"Each experience in this bundle can be explored in detail below.":"Ogni esperienza inclusa in questo pacchetto puÃ² essere esplorata in dettaglio qui sotto.";e.textContent=s},renderIncludedTripCard:(e,o,n)=>{const s=e.langTrip&&e.langTrip.title||e.id,t=e.langTrip&&e.langTrip.short_desc||"",a=e.langTrip&&e.langTrip.duration||n.daily||"",i=d.getImagesForTrip(e.id,e.apiTrip),r=[...new Set(i)].filter(Boolean),l="trip-img-"+e.id,c=document.createElement("button");c.type="button",c.className="text-left bg-gray-900 border border-gray-800 rounded-xl p-3 hover:border-gold hover:shadow-lg transition flex gap-4 group overflow-hidden",c.setAttribute("data-trip-id",e.id),c.innerHTML='<div class="w-24 h-24 shrink-0 rounded-lg overflow-hidden relative"><img id="'+l+'" src="'+r[0]+'" class="w-full h-full object-cover transform group-hover:scale-110 transition duration-700" loading="lazy" alt="'+s+'"></div><div class="flex flex-col gap-1 flex-1 min-w-0 justify-center"><h4 class="text-white font-semibold text-sm md:text-base truncate pr-2 group-hover:text-gold transition-colors">'+s+'</h4><p class="text-gold text-xs font-bold uppercase tracking-wider">'+a+'</p><p class="text-gray-400 text-xs line-clamp-2 leading-relaxed">'+t+"</p></div>",c.addEventListener("click",()=>{d.openIncludedTripModal(e)}),o.appendChild(c),d.setupSlideshow(r,l)},getImagesForTrip:(e,o)=>{const n=window.ImagePaths?window.ImagePaths.resolveTripContext({trip_id:e,...o||{}}):{location:"",category:""},s=window.ImagePaths?window.ImagePaths.getPoster(n.location,n.category,e):"assets/images/trips/"+e+"/poster.webp",t=window.ImagePaths&&typeof window.ImagePaths.pickCI=="function"?window.ImagePaths.pickCI(o||{},"img_count"):"",a=parseInt(t||"0",10),i=window.ImagePaths&&typeof window.ImagePaths.getGalleryArray=="function"?window.ImagePaths.getGalleryArray(n.location,n.category,e,a):[];return[s,...i]},openIncludedTripModal:e=>{const o=document.getElementById("included-trip-modal");if(!o)return;const n=PackagesModel.state.lang,s=n==="en"?window.i18nEn||{}:window.i18nIt||{},t=e.apiTrip||{},a=e.langTrip||{},i=e.id,r=s.global||{};d.populateModalHero(i,t,n,a),d.populateModalInfo(i,a,r),d.populateModalLists(a),d.populateModalPrice(t,r),o.classList.remove("hidden");const l=o.querySelector(".overflow-y-auto");l&&(l.scrollTop=0),document&&document.body&&(document.body.style.overflow="hidden"),d.bindModalClose()},populateModalHero:(e,o,n,s)=>{const t=document.getElementById("included-trip-modal-hero"),a=document.getElementById("included-trip-modal-gallery"),i=document.getElementById("included-trip-badge"),r=d.getImagesForTrip(e,o),l=r[0];if(t){t.style.backgroundImage="url('"+l+"')";const g=window.ImagePaths?window.ImagePaths.resolveTripContext({trip_id:e,...o||{}}):{location:"",category:""};window.ImagePaths&&typeof window.ImagePaths.resolvePosterOrPlaceholder=="function"&&window.ImagePaths.resolvePosterOrPlaceholder(g.location,g.category,e).then(u=>{t.style.backgroundImage="url('"+u+"')"})}const c=o?n==="en"?o.badge_en:o.badge_it:"";i&&(c?(i.textContent=c,i.classList.remove("hidden"),i.classList.add("inline-block")):(i.classList.add("hidden"),i.classList.remove("inline-block"))),a&&(a.innerHTML="",[...new Set(r)].filter(Boolean).forEach(u=>{d.createGalleryThumb(u,a,t,"w-24 h-16")}))},populateModalInfo:(e,o,n)=>{const s=document.getElementById("included-trip-title"),t=document.getElementById("included-trip-duration"),a=document.getElementById("included-trip-desc"),i=document.getElementById("included-trip-full-desc"),r=document.getElementById("included-trip-important");s&&(s.textContent=o.title||e);const l=typeof n.daily=="string"?n.daily:"";t&&(t.innerHTML='<svg class="w-5 h-5 text-gold" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><span>'+(o.duration||l)+"</span>"),a&&(a.textContent=o.short_desc||""),i&&(i.innerHTML=o.full_description||""),r&&(r.textContent=o.important_notes||"")},populateModalLists:e=>{const o=document.getElementById("included-trip-highlights"),n=document.getElementById("included-trip-includes"),s=document.getElementById("included-trip-excludes"),t=document.getElementById("included-trip-program");if(d.renderList(o,e.highlights),d.renderList(n,e.includes,!0,"check"),d.renderList(s,e.not_included,!0,"cross"),t&&(t.innerHTML="",Array.isArray(e.program))){const a=document.createDocumentFragment();e.program.forEach(i=>{const r=document.createElement("div");r.className="flex items-start gap-4",r.innerHTML='<div class="text-gold font-bold min-w-[70px] pt-1">'+(i.time||"")+'</div><div class="flex-1"><div class="text-white font-semibold text-base mb-1">'+(i.activity||"")+'</div><div class="text-gray-400 text-sm leading-relaxed">'+(i.details||"")+"</div></div>",a.appendChild(r)}),t.appendChild(a)}},populateModalPrice:(e,o)=>{const n=document.getElementById("included-trip-price"),s=document.getElementById("included-trip-price-breakdown"),t=e?parseFloat(e.p_adult||"0"):0,a=e?parseFloat(e.d_adult||"0"):0,i=e?parseFloat(e.p_child||"0"):0,r=e?parseFloat(e.d_child||"0"):0,l=e?parseInt(e.min_pax||"1",10):1,c=a>0?'<span class="inline-flex items-center gap-2"><span class="line-through text-gray-400 text-lg">â‚¬'+t+'</span><span class="text-gold font-bold text-3xl">â‚¬'+a+"</span></span>":'<span class="inline-flex items-center gap-2"><span class="text-gold font-bold text-3xl">â‚¬'+t+"</span></span>";if(n&&(n.innerHTML=c),s){const u=(o.pricing||{}).min_pax||"Min Pax",m=a>0?'<div class="flex items-center gap-2"><span>ðŸ‘¤</span><span class="line-through text-gray-400">â‚¬'+t+'</span><span class="text-white font-bold">â‚¬'+a+"</span></div>":'<div class="flex items-center gap-2"><span>ðŸ‘¤</span><span class="text-white font-bold">â‚¬'+t+"</span></div>",y=r>0||i>0?r>0?'<div class="flex items-center gap-2"><span>ðŸ‘¶</span><span class="line-through text-gray-400">â‚¬'+i+'</span><span class="text-white font-bold">â‚¬'+r+"</span></div>":'<div class="flex items-center gap-2"><span>ðŸ‘¶</span><span class="text-white font-bold">â‚¬'+i+"</span></div>":"",f='<div class="flex items-center gap-2 text-gray-400 text-sm mt-1 pt-1 border-t border-gray-800 w-full"><span>ðŸ‘¥</span><span>'+u+": "+l+"</span></div>";s.innerHTML=m+y+f}},setupSlideshow:(e,o)=>{if(e.length>1){let n=0;const s=setInterval(()=>{const t=document.getElementById(o);t&&(t.style.opacity="0",setTimeout(()=>{const a=document.getElementById(o);a&&(n=(n+1)%e.length,a.src=e[n],a.style.opacity="1")},200))},3e3);PackagesModel.addInterval(s)}},setupStickyBehavior:()=>{const e=document.getElementById("sticky-mobile-book"),o=document.getElementById("booking-card-container");if(!e||!o)return;const n=e.querySelector('span[data-i18n="global.book_package_now"]')||e.querySelector('span[data-i18n="global.book_now"]'),s=document.querySelector('#btn-submit-booking span[data-i18n="global.book_package_now"]')||document.querySelector("#btn-submit-booking span");setInterval(()=>{n&&(n.classList.add("animate-wiggle"),setTimeout(()=>n.classList.remove("animate-wiggle"),1200)),s&&(s.classList.add("animate-wiggle"),setTimeout(()=>s.classList.remove("animate-wiggle"),1200))},8e3),new IntersectionObserver(i=>{const r=i[0];r&&r.isIntersecting&&r.intersectionRatio>.1?(e.classList.add("opacity-0","pointer-events-none"),e.classList.remove("opacity-100")):(e.classList.add("opacity-100"),e.classList.remove("opacity-0","pointer-events-none"))},{root:null,threshold:[0,.1,1]}).observe(o)},renderList:(e,o,n,s)=>{if(!e||(e.innerHTML="",!Array.isArray(o)||o.length===0))return;const t=document.createDocumentFragment();let a="";n&&(s==="check"?a='<svg class="w-4 h-4 text-green-500 mt-1 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>':s==="cross"&&(a='<svg class="w-4 h-4 text-red-500 mt-1 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>')),o.forEach(i=>{const r=document.createElement("li");n&&a?(r.className="flex items-start gap-2",r.innerHTML=a+"<span>"+i+"</span>"):r.textContent=i,n||(r.style.listStyle="none"),t.appendChild(r)}),e.appendChild(t)},renderProgram:(e,o)=>{if(!e||(e.innerHTML="",!Array.isArray(o)))return;const n=document.createDocumentFragment();o.forEach(s=>{const t=s.time||"",a=s.activity||"",i=s.details||"",r=document.createElement("div");r.className="flex items-start gap-4 mb-4",r.innerHTML='<div class="text-gold font-bold min-w-[72px]">'+t+'</div><div><div class="text-white font-semibold">'+a+'</div><div class="text-gray-400 text-sm">'+i+"</div></div>",n.appendChild(r)}),e.appendChild(n)},createGalleryThumb:(e,o,n,s)=>{if(!o||!e)return;const t=document.createElement("button");t.type="button",t.className=s+" rounded-lg overflow-hidden bg-gray-800 flex-shrink-0 border border-gray-700 hover:border-gold transition",t.innerHTML='<img src="'+e+'" class="w-full h-full object-cover" loading="lazy">',t.addEventListener("click",()=>{n&&(n.style.backgroundImage="url('"+e+"')")}),o.appendChild(t)},bindModalClose:()=>{const e=document.getElementById("included-trip-modal"),o=document.getElementById("included-trip-modal-close");if(!e)return;const n=()=>{e.classList.add("hidden"),document&&document.body&&(document.body.style.overflow="")};o&&!o.__bound&&(o.__bound=!0,o.addEventListener("click",n)),e.__boundClick||(e.__boundClick=!0,e.addEventListener("click",s=>{s.target===e&&n()}))}};window.PackagesView=d;const I={init:async()=>{const o=new URLSearchParams(window.location.search).get("id");if(!o){window.location.href="index.html";return}const n=PackagesModel.getLang(),s=PackagesModel.getI18n(n);if(!window.PackagesService||typeof window.PackagesService.loadAll!="function"){PackagesView.renderNotFound(s,n);return}try{const t=await window.PackagesService.loadAll();if(!t){PackagesView.renderNotFound(s,n);return}const a=PackagesModel.findPackageById(t.packagesList,o);if(!a){PackagesView.renderNotFound(s,n);return}const i=a.trip_id||a.package_id,l=(s.trips||{})[i]||null;PackagesModel.setStateFromData(a,t.tripsList,l,n),PackagesView.renderPackageShell(PackagesModel.state,s);const c=Array.isArray(t.addonsList)?t.addonsList.filter(g=>String(g.trip_id||"")===i):[];window.BookingManager&&typeof window.BookingManager.init=="function"&&window.BookingManager.init(i,a,l,c),PackagesView.setupStickyBar(),PackagesView.renderIncludedTrips(a,PackagesModel.state.allTrips,s)}catch{PackagesView.renderNotFound(s,n)}}};window.PackagesController=I;window.addEventListener("langChanged",()=>{window.PackagesController&&typeof window.PackagesController.init=="function"&&window.PackagesController.init()});
