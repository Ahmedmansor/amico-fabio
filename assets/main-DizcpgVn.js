import"./global-footer-BbqeWLtq.js";const h={init:()=>{const e=document.getElementById("hero-slider-section");if(!e)return;const t=e.querySelectorAll(".hero-slide");!t||t.length===0||h.start(t)},start:e=>{let t=0;const n=a=>{e.forEach(i=>i.classList.remove("active-slide")),e[a].classList.add("active-slide")},o=()=>{t=(t+1)%e.length,n(t)};n(0),setInterval(o,3e3)}};document.readyState==="loading"?window.addEventListener("load",h.init):h.init();window.HeroSlider=h;console.log("Fabio Tours App Started");navigator.serviceWorker.getRegistrations().then(e=>{e.forEach(t=>{t.unregister()})});"caches"in window&&caches.keys().then(e=>{e.forEach(t=>{caches.delete(t)})});const p={it:window.i18nIt,en:window.i18nEn};let f="it";function m(e,t){if(!e||!t)return null;const n=t.split(".");let o=e;for(let a=0;a<n.length;a+=1){const i=n[a];if(o&&Object.prototype.hasOwnProperty.call(o,i))o=o[i];else return null}return o}function B(e){const t=p[e];if(!t)return;document.querySelectorAll("[data-i18n]").forEach(i=>{const r=i.getAttribute("data-i18n"),s=m(t,r);typeof s=="string"&&(i.textContent=s)}),document.querySelectorAll("[data-img]").forEach(i=>{const r=i.getAttribute("data-img"),s=m(t,r);typeof s=="string"&&(i.src=s)}),document.querySelectorAll("[data-landing-img]").forEach(i=>{const r=i.getAttribute("data-landing-img");if(window.ImagePaths){const s=m(window.ImagePaths,r);typeof s=="string"&&(i.src=s)}})}function $(e){if(f=e,document.documentElement.lang=e,localStorage.setItem("fabio_lang",e),localStorage.setItem("preferredLanguage",e),B(e),window.dispatchEvent(new CustomEvent("langChanged",{detail:{lang:e}})),document.getElementById("servicesFlow")&&(w("servicesFlow","secrets.page2.services",x),w("rules-page3","secrets.page3.rules",x),w("packing-checklist","secrets.page4.items",T),w("adventuresGrid","secrets.page6.items",C),A(),D(e)),window.PromoBanner&&window.appData&&window.appData.Global_Settings&&window.PromoBanner.render(window.appData.Global_Settings),typeof window.renderLegal=="function")try{window.renderLegal(e)}catch{}}function w(e,t,n){const o=document.getElementById(e);if(!o)return;const a=p[f];if(!a)return;const i=m(a,t);if(o.innerHTML="",Array.isArray(i)){const r=document.createDocumentFragment();i.forEach((s,c)=>{const d=n(s,c,a);if(!d)return;const l=document.createElement("div");for(l.innerHTML=d.trim();l.firstChild;)r.appendChild(l.firstChild)}),o.appendChild(r)}else if(i&&typeof i=="object"){const r=n(i,0,a);if(r){const s=document.createElement("div");for(s.innerHTML=r.trim();s.firstChild;)o.appendChild(s.firstChild)}}}function x(e,t){if(!e)return"";const n=t===0?0:t*80,o=String(n),a=typeof e.img=="string"?e.img:"",i=e.title||e.name||"",r=e.desc||"",s=e.extra_title||"",c=e.extra_desc||"",l=s||c?`
      <div class="catalog-card-extra">
        ${s?`<h4 class="catalog-card-extra-title">${s}</h4>`:""}
        ${c?`<p class="catalog-card-extra-desc">${c}</p>`:""}
      </div>
    `:"";return`
    <article class="catalog-card sharm-reveal"${o!=="0"?` style="animation-delay: ${o}ms"`:""}>
      <div class="catalog-card-main">
        <h3 class="catalog-card-title">${i}</h3>
        <p class="catalog-card-desc">${r}</p>
      </div>
      <div class="catalog-card-image">
        <img src="${a}" alt="${i}" class="catalog-card-img" loading="lazy">
      </div>
      ${l}
    </article>
  `}function T(e,t){if(!e)return"";const n=typeof e.icon=="string"?e.icon:"",o=n?`fa-solid ${n} checklist-icon-glyph`:"fa-solid fa-circle checklist-icon-glyph";return`
    <div class="checklist-item sharm-reveal" style="animation-delay: ${t*70}ms">
      <div class="checklist-icon">
        <i class="${o}" aria-hidden="true"></i>
      </div>
      <div class="checklist-text">
        <h4>${e.title||""}</h4>
        <p>${e.desc||""}</p>
      </div>
    </div>
  `}function C(e,t){if(!e)return"";const n=typeof e.img=="string"?e.img:"";return`
    <div class="adventure-slide">
      <button type="button" class="adventure-card sharm-reveal" data-index="${String(t)}" style="animation-delay: ${t*80}ms">
        <img src="${n}" class="adventure-photo" alt="" loading="lazy" decoding="async">
        <div class="adventure-caption">${e.cap||""}</div>
      </button>
    </div>
  `}let g=null,b=null;function A(){const e=document.getElementById("adventuresGrid");if(!e||e.dataset.autoScrollBound==="true")return;e.dataset.autoScrollBound="true";const t=()=>{const i=e.querySelector(".adventure-slide");if(!i)return 0;const r=window.getComputedStyle(e),s=parseFloat(r.gap||r.columnGap||"0");return i.getBoundingClientRect().width+s},n=()=>{const i=t();if(!i)return;const r=e.scrollWidth-e.clientWidth;if(r<=0)return;const s=e.scrollLeft+i;e.scrollTo({left:s>=r-2?0:s,behavior:"smooth"})},o=()=>{g&&clearInterval(g),g=setInterval(n,2e3)},a=()=>{g&&clearInterval(g),b&&clearTimeout(b),b=setTimeout(o,2500)};e.addEventListener("pointerdown",a,{passive:!0}),e.addEventListener("wheel",a,{passive:!0}),e.addEventListener("touchstart",a,{passive:!0}),e.addEventListener("scroll",a,{passive:!0}),o()}function P(e){const t=document.querySelector(e);if(!t)return;const n=80,o=t.getBoundingClientRect(),a=window.scrollY+o.top-n;window.scrollTo({top:a,behavior:"smooth"})}function M(){const e=document.getElementById("indexMenu");e&&e.classList.add("is-visible")}function E(){const e=document.getElementById("indexMenu");e&&e.classList.remove("is-visible")}function D(e){const t=p[e];if(!t)return;const n=document.getElementById("indexMenu");if(!n)return;const o=n.querySelector(".index-menu-nav");if(!o)return;const a=[{id:"#page1",key:"secrets.page1.headline"},{id:"#page2",key:"secrets.page2.headline"},{id:"#page3",key:"secrets.page3.headline"},{id:"#page4",key:"secrets.page4.list_title"},{id:"#page5",key:"secrets.page5.highlight"},{id:"#page6",key:"secrets.page6.title"}];o.innerHTML="",a.forEach((i,r)=>{const s=m(t,i.key),c=document.createElement("button");c.type="button",c.className="index-link",typeof s=="string"?c.textContent=`${r+1} Â· ${s}`:c.textContent=`Section ${r+1}`,c.addEventListener("click",()=>{E(),P(i.id)}),o.appendChild(c)})}function _(){const e=document.getElementById("indexToggle"),t=document.getElementById("indexMenu");if(!e||!t)return;const n=t.querySelector(".index-menu-close");e.addEventListener("click",()=>{M()}),n&&n.addEventListener("click",()=>{E()}),t.addEventListener("click",o=>{o.target===t&&E()})}function F(){const e=document.getElementById("adventuresModal"),t=document.getElementById("adventuresModalImage"),n=document.getElementById("adventuresModalCaption");if(!e||!t||!n)return;const o=e.querySelector(".adventures-modal-close"),a=document.getElementById("adventuresGrid");a&&a.addEventListener("click",r=>{const c=r.target.closest(".adventure-card");if(!c)return;const d=c.getAttribute("data-index"),l=d?parseInt(d,10):0,v=p[f],y=v&&v.secrets&&v.secrets.page6,S=y&&Array.isArray(y.items)?y.items:[],u=S[l]||S[0],k=u&&typeof u.img=="string"?u.img:"";t.src=k,n.textContent=u&&u.cap?u.cap:"",e.classList.add("is-visible")});function i(){e.classList.remove("is-visible")}o&&o.addEventListener("click",()=>{i()}),e.addEventListener("click",r=>{r.target===e&&i()})}function q(){if(!window.ImagePaths||!window.ImagePaths.secrets||!window.ImagePaths.secrets.bg)return;const e=window.ImagePaths.secrets.bg,t=(n,o)=>{const a=document.querySelector(n);a&&a.style.setProperty("--bg-image",`url('${o}')`)};t(".section-hero",e.hero),t(".section-2",e.sec2),t(".section-3",e.sec3),t(".section-4",e.sec4),t(".section-5",e.sec5),t(".section-6",e.sec6)}const I={init:async()=>{window.UILayout&&window.UILayout.init(),"serviceWorker"in navigator&&navigator.serviceWorker.getRegistrations().then(function(a){for(let i of a)i.unregister()});const e=localStorage.getItem("fabio_lang"),t=localStorage.getItem("preferredLanguage"),n=e||t||"it";p[n]&&(f=n),$(f),document.getElementById("trips-grid")?await I.initTripCatalog():I.initSharmSecrets();const o=document.getElementById("who-fabio");if(o&&window.WhoFabioParallax)try{window.WFParallax=window.WFParallax||new window.WhoFabioParallax(o)}catch{}},initTripCatalog:async()=>{if(document.getElementById("trips-grid"),window.api&&window.api.fetchAllData){const t=await window.api.fetchAllData();if(!t){console.error("App: Data fetch returned null.");return}if(window.appData=t,window.PromoBanner&&t.Global_Settings&&window.PromoBanner.render(t.Global_Settings),window.UILayout&&window.UILayout.init(),!window.TripsRenderer||!t.Trips_Prices){const n=document.getElementById("trips-grid");if(n){const a=(localStorage.getItem("fabio_lang")||document.documentElement.lang||"it")==="en"?window.i18nEn||{}:window.i18nIt||{},i=a.global&&typeof a.global.loading_failed=="string"?a.global.loading_failed:"";n.innerHTML=`<div class="col-span-full text-center py-12">
                <p class="text-gold text-xl" data-i18n="global.loading_failed">${i}</p>
            </div>`}}L()}else console.error("API module not found")},initSharmSecrets:()=>{q(),_(),F(),L()}};function L(){const e=document.getElementById("global-footer")||document.querySelector("footer");if(!e)return;new IntersectionObserver(n=>{n.forEach(o=>{o.isIntersecting?document.body.classList.add("hide-floating-widgets"):document.body.classList.remove("hide-floating-widgets")})},{root:null,threshold:.1}).observe(e)}window.appData=window.appData||{};window.appData.openBooking=e=>{const t="201063239261",n=`Ciao Fabio! I want to book trip: ${e}`;window.open(`https://wa.me/${t}?text=${encodeURIComponent(n)}`,"_blank")};document.addEventListener("DOMContentLoaded",()=>{I.init()});
