import"./global-footer-HRMOwUjU.js";import"./ui-layout-BzRTcNJb.js";import{i as F}from"./faq-loader-Dk-zilFa.js";const i={init:async()=>{const e=new URLSearchParams(window.location.search).get("id");sessionStorage.setItem("fabio_nav_source","details");const o=document.getElementById("whatsapp-float");o&&o.remove();const n=document.querySelector(".wa-fab-label");n&&n.remove();const a=document.getElementById("hero-back-btn");if(a&&(a.onclick=()=>{document&&document.referrer?window.history.back():window.location.href="explore.html"}),i.setupFaqAccordion(),!e){window.location.href="index.html";return}typeof i.renderGalleryImmediate=="function"&&i.renderGalleryImmediate(e);const l=localStorage.getItem("fabio_lang")||document.documentElement.lang||"it",c=l==="en"?window.i18nEn||{}:window.i18nIt||{},d=c.trips?c.trips[e]:null;let r=null;const m=sessionStorage.getItem("fabio_data_cache");if(m)try{const g=JSON.parse(m);r=(Array.isArray(g)?g:g.Trips_Prices||[]).find(f=>f.trip_id===e)}catch{}if(r||d){if(r)i.render(e,r,d,l);else if(i.renderStaticFirst(e,d,l),window.api&&window.api.fetchAllData){const g=await window.api.fetchAllData();sessionStorage.setItem("fabio_data_cache",JSON.stringify(g));const f=(g.Trips_Prices||[]).find(y=>y.trip_id===e);f&&i.updatePriceOnly(f)}}else{const g=l==="en"?window.i18nEn||{}:window.i18nIt||{},u=g&&g.global&&typeof g.global.experience_not_found=="string"?g.global.experience_not_found:"";document.querySelector("main").innerHTML=`
                <div class="h-screen flex items-center justify-center text-white">
                    <h1 class="text-3xl font-playfair text-gold" data-i18n="global.experience_not_found">${u}</h1>
                </div>
            `}},state:{apiData:null,langData:null,lang:"it",tripId:"",autoTimer:null,autoIndex:0,autoList:[]},iconMarkup:(t,e)=>{const o=window.ImagePaths&&window.ImagePaths.icons&&window.ImagePaths.icons.people?window.ImagePaths.icons.people:null,n=o&&o[t]?o[t]:"";return n?`<img src="${n}" alt="" class="price-icon-img">`:e},applyHeroImage:(t,e)=>{!t||!e||(t.classList.remove("hero-img-animate"),t.offsetWidth,t.src=e,t.classList.add("hero-img-animate"))},setGalleryActive:(t,e,o=!0)=>{if(!t||!e)return;Array.from(t.querySelectorAll(".gallery-thumb")).forEach(c=>c.classList.remove("is-active"));const a=t.querySelector(`img[src="${e}"]`),l=a?a.closest(".gallery-thumb"):null;if(l&&(l.classList.add("is-active"),o)){const c=t.clientWidth||0,d=l.offsetWidth||0,r=l.offsetLeft-Math.max(0,(c-d)/2);t.scrollTo({left:Math.max(0,r),behavior:"smooth"})}},startAutoHero:(t,e,o=0,n=null)=>{!e||!Array.isArray(t)||t.length<2||(i.state.autoTimer&&(clearInterval(i.state.autoTimer),i.state.autoTimer=null),i.state.autoList=t.slice(),i.state.autoIndex=Math.max(0,Math.min(o,t.length-1)),i.state.autoTimer=setInterval(()=>{const a=i.state.autoList||[];if(!a.length)return;const l=(i.state.autoIndex+1)%a.length;i.state.autoIndex=l,i.applyHeroImage(e,a[l]),i.setGalleryActive(n,a[l],!0)},2e3))},setHeroImage:(t,e,o)=>{if(!t||!e)return;i.applyHeroImage(t,e);const n=i.state.autoList||[];if(n.length){const a=n.indexOf(e);i.startAutoHero(n,t,a>=0?a:0,o)}i.setGalleryActive(o,e,!0)},render:(t,e,o,n)=>{const a=localStorage.getItem("fabio_lang")||document.documentElement.lang||"it",l=a==="en"?window.i18nEn||{}:window.i18nIt||{},c=l.trips?l.trips[t]:null;n=a,o=c||o;const d=o&&o.title||e&&e.trip_id||t,r=e?parseFloat(e.p_adult||"0"):0,m=e?parseFloat(e.d_adult||"0"):0,g=e?parseFloat(e.p_child||"0"):0,u=e?parseFloat(e.d_child||"0"):0,f=e?parseInt(e.min_pax||"1",10):1,y=e?n==="en"?e.badge_en:e.badge_it:"";document.title=`Fabio Tours | ${d}`;const h=document.querySelector('meta[name="description"]')||(function(){const p=document.createElement("meta");return p.setAttribute("name","description"),document.head.appendChild(p),p})(),b=o&&o.short_desc||o&&o.full_description||"",_=typeof b=="string"?b.replace(/\s+/g," ").trim().slice(0,200):"";h&&h.setAttribute("content",_);const s={bg:document.getElementById("hero-bg-img"),title:document.getElementById("detail-title"),badge:document.getElementById("detail-badge"),duration:document.getElementById("detail-duration"),price:document.getElementById("detail-price"),desc:document.getElementById("detail-desc"),highlights:document.getElementById("detail-highlights"),fullDesc:document.getElementById("detail-full-desc"),program:document.getElementById("detail-program"),important:document.getElementById("detail-important"),cardPrice:document.getElementById("card-price"),includes:document.getElementById("detail-includes"),excludes:document.getElementById("detail-excludes"),gallery:document.getElementById("gallery-grid"),btnBook:document.getElementById("btn-submit-booking")||document.getElementById("btn-book")},I=(typeof window<"u"&&window.location&&window.location.pathname?window.location.pathname.split("/"):[]).filter(Boolean)[0]||"",M=I?`/${I}/`:"/",B=typeof window<"u"&&window.FABIO_BASE_URL||M,x=window.ImagePaths?window.ImagePaths.resolveTripContext({trip_id:t,...e||{}}):{location:"",category:""},E=window.ImagePaths?window.ImagePaths.getPoster(x.location,x.category,t):`${B}assets/images/trips/${t}/poster.webp`,O=window.ImagePaths?window.ImagePaths.ui.fallbackLogo:`${B}assets/images/logo/logo-fabio-square.webp`;s.bg&&(i.applyHeroImage(s.bg,E),window.ImagePaths&&typeof window.ImagePaths.resolvePosterOrPlaceholder=="function"?window.ImagePaths.resolvePosterOrPlaceholder(x.location,x.category,t).then(p=>{i.applyHeroImage(s.bg,p)}):s.bg.onerror=()=>{i.applyHeroImage(s.bg,O)}),s.title&&(s.title.textContent=d),y?s.badge&&(s.badge.textContent=y,s.badge.style.display="inline-block"):s.badge&&(s.badge.style.display="none");const $=i.iconMarkup("personMale","ðŸ‘¤"),R=i.iconMarkup("persons","ðŸ‘¥"),H=i.iconMarkup("child","ðŸ‘¶"),j=m>0?`<span class="inline-flex items-center gap-2">${$}<span class="line-through text-gray-400">â‚¬${r}</span><span class="text-gold font-bold">â‚¬${m}</span></span>`:`<span class="inline-flex items-center gap-2">${$}<span class="text-gold font-bold">â‚¬${r}</span></span>`;s.price&&(s.price.innerHTML=j);const T=m>0?m:r;s.cardPrice&&(s.cardPrice.textContent=`â‚¬${T}`);const C=document.getElementById("live-total-price");C&&(C.textContent=`â‚¬${T}`);const G=document.getElementById("card-price-breakdown");if(G){const v=(l&&l.global&&l.global.pricing?l.global.pricing:{}).min_pax||"Min Pax",P=m>0?`<div class="flex items-center gap-2">${$}<span class="line-through text-gray-400">â‚¬${r}</span><span class="text-white font-bold">â‚¬${m}</span></div>`:`<div class="flex items-center gap-2">${$}<span class="text-white font-bold">â‚¬${r}</span></div>`,A=u>0||g>0?u>0?`<div class="flex items-center gap-2">${H}<span class="line-through text-gray-400">â‚¬${g}</span><span class="text-white font-bold">â‚¬${u}</span></div>`:`<div class="flex items-center gap-2">${H}<span class="text-white font-bold">â‚¬${g}</span></div>`:"",S=`<div class="flex items-center gap-2">${R}<span class="text-gray-300">${v}: ${f}</span></div>`;G.innerHTML=`${P}${A||""}${S}`}if(o){const p=n==="en"?window.i18nEn||{}:window.i18nIt||{},v=p&&p.global&&typeof p.global.daily=="string"?p.global.daily:"";s.duration&&(s.duration.textContent=o.duration||v),s.desc&&(s.desc.innerHTML=o.short_desc||""),s.fullDesc&&(s.fullDesc.innerHTML=o.full_description||""),s.important&&(s.important.textContent=o.important_notes||""),i.renderList(s.highlights,o.highlights),i.renderList(s.includes,o.includes,!0,"check"),i.renderList(s.excludes,o.not_included,!0,"cross"),s.program&&o.program&&i.renderProgram(s.program,o.program)}const L=n==="en"?window.i18nEn||{}:window.i18nIt||{},N=L&&L.global&&typeof L.global.book_now=="string"?L.global.book_now:"";s.btnBook&&(s.btnBook.textContent=N);const q=document.getElementById("sticky-mobile-book");q&&(setTimeout(()=>{q.classList.remove("translate-y-32")},200),i.setupStickyBehavior());const W=window.ImagePaths&&typeof window.ImagePaths.pickCI=="function"?window.ImagePaths.pickCI(e||{},"img_count"):"",z=parseInt(W||"0",10),k=window.ImagePaths&&typeof window.ImagePaths.getGalleryArray=="function"?window.ImagePaths.getGalleryArray(x.location,x.category,t,z):[],U=[E,...Array.isArray(k)?k:[]];s.gallery&&s.gallery.children.length===0&&(i.appendGalleryItem(E,s.gallery,s.bg),Array.isArray(k)&&k.length>0&&k.forEach(p=>i.appendGalleryItem(p,s.gallery,s.bg))),s.bg&&i.startAutoHero(U,s.bg,0,s.gallery),i.setGalleryActive(s.gallery,E,!1);try{const p=sessionStorage.getItem("fabio_data_cache")||sessionStorage.getItem("fabio_trips_cache");let v=[];if(p){const P=JSON.parse(p),A=P&&Array.isArray(P.Trip_Addons)?P.Trip_Addons:[];v=Array.isArray(A)?A.filter(S=>String(S.trip_id||"")===t):[]}i.state.apiData=e,i.state.langData=o,i.state.lang=n,i.state.tripId=t,window.BookingManager&&window.BookingManager.init(t,e,o,v)}catch{i.state.apiData=e,i.state.langData=o,i.state.lang=n,i.state.tripId=t,window.BookingManager&&window.BookingManager.init(t,e,o,[])}},setupStickyBehavior:()=>{const t=document.getElementById("sticky-mobile-book"),e=document.getElementById("booking-card-container");if(!t||!e)return;const o=t.querySelector('span[data-i18n="global.book_now"]');setInterval(()=>{o&&(o.classList.add("animate-wiggle"),setTimeout(()=>o.classList.remove("animate-wiggle"),1200))},8e3),new IntersectionObserver(l=>{const c=l[0];c&&c.isIntersecting&&c.intersectionRatio>.2?(t.classList.add("opacity-0","pointer-events-none"),t.classList.remove("opacity-100")):(t.classList.add("opacity-100"),t.classList.remove("opacity-0","pointer-events-none"))},{root:null,threshold:[0,.2,.5,1]}).observe(e)},renderStaticFirst:(t,e,o)=>{const n={bg:document.getElementById("hero-bg-img"),title:document.getElementById("detail-title"),badge:document.getElementById("detail-badge"),duration:document.getElementById("detail-duration"),price:document.getElementById("detail-price"),desc:document.getElementById("detail-desc"),highlights:document.getElementById("detail-highlights"),fullDesc:document.getElementById("detail-full-desc"),program:document.getElementById("detail-program"),important:document.getElementById("detail-important"),cardPrice:document.getElementById("card-price"),cardBreakdown:document.getElementById("card-price-breakdown"),includes:document.getElementById("detail-includes"),excludes:document.getElementById("detail-excludes"),gallery:document.getElementById("gallery-grid"),btnBook:document.getElementById("btn-submit-booking")||document.getElementById("btn-book")},l=(typeof window<"u"&&window.location&&window.location.pathname?window.location.pathname.split("/"):[]).filter(Boolean)[0]||"",c=l?`/${l}/`:"/",d=typeof window<"u"&&window.FABIO_BASE_URL||c,r=window.ImagePaths?window.ImagePaths.resolveTripContext({trip_id:t}):{location:"",category:""},m=window.ImagePaths?window.ImagePaths.getPoster(r.location,r.category,t):`${d}assets/images/trips/${t}/poster.webp`,g=window.ImagePaths?window.ImagePaths.ui.fallbackLogo:`${d}assets/images/logo/logo-fabio-square.webp`;n.bg&&(i.applyHeroImage(n.bg,m),window.ImagePaths&&typeof window.ImagePaths.resolvePosterOrPlaceholder=="function"?window.ImagePaths.resolvePosterOrPlaceholder(r.location,r.category,t).then(w=>{i.applyHeroImage(n.bg,w)}):n.bg.onerror=()=>{i.applyHeroImage(n.bg,g)});const u=e&&e.title||t;n.title&&(n.title.textContent=u),n.price&&(n.price.innerHTML='<span class="price-skeleton inline-block"></span>'),n.cardPrice&&(n.cardPrice.innerHTML='<span class="price-skeleton inline-block"></span>'),n.cardBreakdown&&(n.cardBreakdown.innerHTML='<div class="price-skeleton" style="width: 80%; height: 1.2rem;"></div>');const f=document.getElementById("live-total-price");if(f&&(f.textContent="â‚¬0"),e){const w=o==="en"?window.i18nEn||{}:window.i18nIt||{},I=w&&w.global&&typeof w.global.daily=="string"?w.global.daily:"";n.duration&&(n.duration.textContent=e.duration||I),n.desc&&(n.desc.innerHTML=e.short_desc||""),n.fullDesc&&(n.fullDesc.innerHTML=e.full_description||""),n.important&&(n.important.textContent=e.important_notes||""),i.renderList(n.highlights,e.highlights),i.renderList(n.includes,e.includes,!0,"check"),i.renderList(n.excludes,e.not_included,!0,"cross"),n.program&&e.program&&i.renderProgram(n.program,e.program)}const y=window.ImagePaths&&typeof window.ImagePaths.getGalleryArray=="function"?window.ImagePaths.getGalleryArray(r.location,r.category,t,0):[],h=[m,...Array.isArray(y)?y:[]];n.gallery&&n.gallery.children.length===0&&(i.appendGalleryItem(m,n.gallery,n.bg),Array.isArray(y)&&y.length>0&&y.forEach(w=>i.appendGalleryItem(w,n.gallery,n.bg))),n.bg&&i.startAutoHero(h,n.bg,0,n.gallery),i.setGalleryActive(n.gallery,m,!1);const b=o==="en"?window.i18nEn||{}:window.i18nIt||{},_=b&&b.global&&typeof b.global.book_now=="string"?b.global.book_now:"";n.btnBook&&(n.btnBook.textContent=_);const s=document.getElementById("sticky-mobile-book");s&&setTimeout(()=>{s.classList.remove("translate-y-32")},200)},updatePriceOnly:t=>{const e=document.getElementById("detail-price"),o=document.getElementById("card-price"),n=document.getElementById("card-price-breakdown"),a=parseFloat(t.p_adult||"0"),l=parseFloat(t.d_adult||"0"),c=parseFloat(t.p_child||"0"),d=parseFloat(t.d_child||"0"),r=parseInt(t.min_pax||"1",10),m=i.iconMarkup("personMale","ðŸ‘¤"),g=l>0?`<span class="inline-flex items-center gap-2">${m}<span class="line-through text-gray-400">â‚¬${a}</span><span class="text-gold font-bold">â‚¬${l}</span></span>`:`<span class="inline-flex items-center gap-2">${m}<span class="text-gold font-bold">â‚¬${a}</span></span>`;e&&(e.innerHTML=g);const u=l>0?l:a;o&&(o.textContent=`â‚¬${u}`);const f=document.getElementById("live-total-price");if(f&&(f.textContent=`â‚¬${u}`),i.state.apiData=t,window.BookingManager&&(BookingManager.state.apiData=t,BookingManager.calculateTotal()),n){const h=(localStorage.getItem("fabio_lang")||document.documentElement.lang||"it")==="en"?window.i18nEn||{}:window.i18nIt||{},_=(h&&h.global&&h.global.pricing?h.global.pricing:{}).min_pax||"Min Pax",s=i.iconMarkup("personMale","ðŸ‘¤"),w=i.iconMarkup("persons","ðŸ‘¥"),I=i.iconMarkup("child","ðŸ‘¶"),M=l>0?`<div class="flex items-center gap-2">${s}<span class="line-through text-gray-400">â‚¬${a}</span><span class="text-white font-bold">â‚¬${l}</span></div>`:`<div class="flex items-center gap-2">${s}<span class="text-white font-bold">â‚¬${a}</span></div>`,B=d>0||c>0?d>0?`<div class="flex items-center gap-2">${I}<span class="line-through text-gray-400">â‚¬${c}</span><span class="text-white font-bold">â‚¬${d}</span></div>`:`<div class="flex items-center gap-2">${I}<span class="text-white font-bold">â‚¬${c}</span></div>`:"",x=`<div class="flex items-center gap-2">${w}<span class="text-gray-300">${_}: ${r}</span></div>`;n.innerHTML=`${M}${B||""}${x}`}},renderGalleryImmediate:t=>{const e={gallery:document.getElementById("gallery-grid"),bg:document.getElementById("hero-bg-img")};if(!e.gallery)return;const o=window.ImagePaths?window.ImagePaths.resolveTripContext({trip_id:t}):{location:"",category:""},a=(typeof window<"u"&&window.location&&window.location.pathname?window.location.pathname.split("/"):[]).filter(Boolean)[0]||"",l=a?`/${a}/`:"/",c=typeof window<"u"&&window.FABIO_BASE_URL||l,d=window.ImagePaths?window.ImagePaths.getPoster(o.location,o.category,t):`${c}assets/images/trips/${t}/poster.webp`;e.gallery.innerHTML="",i.appendGalleryItem(d,e.gallery,e.bg);const r=window.ImagePaths&&typeof window.ImagePaths.getGalleryArray=="function"?window.ImagePaths.getGalleryArray(o.location,o.category,t,0):[];Array.isArray(r)&&r.length>0&&r.forEach(g=>i.appendGalleryItem(g,e.gallery,e.bg));const m=[d,...Array.isArray(r)?r:[]];e.bg&&i.startAutoHero(m,e.bg,0,e.gallery),i.setGalleryActive(e.gallery,d,!1)},appendGalleryItem:(t,e,o)=>{if(Array.from(e.querySelectorAll("img")).some(l=>l.getAttribute("src")===t))return;const a=document.createElement("div");a.className="gallery-thumb flex-shrink-0 w-32 h-32 md:w-40 md:h-40 aspect-square rounded-xl overflow-hidden cursor-pointer relative group border border-gray-100 shadow-md snap-center",a.innerHTML=`
            <img src="${t}" class="w-full h-full object-cover transform transition-transform duration-700 group-hover:scale-110">
            <div class="absolute inset-0 bg-black/20 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center">
                <svg class="w-8 h-8 text-white drop-shadow-lg" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
            </div>
        `,a.onclick=()=>{i.setHeroImage(o,t,e)},e.appendChild(a)},renderList:(t,e,o=!1,n="check")=>{!e||!Array.isArray(e)||!t||(t.innerHTML=e.map(a=>`
            <li class="flex items-start leading-relaxed border-b border-gray-100 pb-2 last:border-0">
                ${o?n==="check"?'<span class="text-gold mr-3 font-bold">âœ“</span>':'<span class="text-gray-400 mr-3 font-bold">Ã—</span>':'<span class="text-gold mr-3 text-xl">â€¢</span>'}
                <span class="${o?t.id==="detail-highlights"?"text-white text-sm":"text-gray-600 text-sm":t.id==="detail-highlights"?"text-white font-medium":"text-gray-800 font-medium"}">${a}</span>
            </li>
            `).join(""))},renderProgram:(t,e)=>{if(!e||!Array.isArray(e)||!t)return;const o=e.map((n,a)=>{const l=n&&typeof n=="object",c=l&&n.time||"",d=l&&n.activity||"",r=l?n.details||"":String(n||"");return`
                <div class="flex gap-4 mb-6 last:mb-0 relative">
                    <div class="flex flex-col items-center">
                        <div class="w-8 h-8 rounded-full bg-gold text-white flex items-center justify-center font-bold text-sm shadow-lg z-10">
                            ${a+1}
                        </div>
                        ${a!==e.length-1?'<div class="w-0.5 h-full bg-gray-100 absolute top-8"></div>':""}
                    </div>
                    <div class="pb-2">
                        ${c?`<div class="text-sm text-gray-500 mb-1">${c}</div>`:""}
                        ${d?`<div class="text-white font-semibold mb-1">${d}</div>`:""}
                        <p class="text-gray-300 leading-relaxed">${r}</p>
                    </div>
                </div>
            `}).join("");t.innerHTML=o},setupFaqAccordion:()=>{const t=document.querySelectorAll(".faq-item");t.length&&t.forEach(e=>{const o=e.querySelector(".faq-toggle"),n=e.querySelector(".faq-answer"),a=e.querySelector(".faq-icon");!o||!n||o.dataset.bound!=="true"&&(o.dataset.bound="true",o.setAttribute("aria-expanded","false"),n.style.maxHeight="0px",e.classList.remove("is-open"),o.addEventListener("click",()=>{if(o.getAttribute("aria-expanded")==="true"){o.setAttribute("aria-expanded","false"),n.style.maxHeight="0px",e.classList.remove("is-open"),a&&a.classList.remove("rotate-45");return}o.setAttribute("aria-expanded","true"),e.classList.add("is-open"),n.style.maxHeight=`${n.scrollHeight}px`,a&&a.classList.add("rotate-45")}))})}};window.DetailsRenderer=i;window.addEventListener("langChanged",()=>{window.DetailsRenderer&&typeof window.DetailsRenderer.init=="function"&&window.DetailsRenderer.init()});console.log("Trying to init FAQ...");document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{console.log("DOM ready, initializing FAQ..."),F()}):(console.log("DOM already loaded, initializing FAQ immediately..."),F());
